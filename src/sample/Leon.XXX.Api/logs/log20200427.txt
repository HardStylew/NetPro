2020-04-27 14:24:44.374 +08:00 [DBG] Hosting starting
2020-04-27 14:24:44.610 +08:00 [DBG] Failed to locate the development https certificate at 'null'.
2020-04-27 14:24:44.620 +08:00 [INF] Now listening on: http://localhost:5001
2020-04-27 14:24:44.622 +08:00 [DBG] Loaded hosting startup assembly Leon.XXX.Api
2020-04-27 14:24:44.626 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 14:24:44.651 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 14:24:44.735 +08:00 [DBG] Connection id "0HLVAEEMM6ODK" accepted.
2020-04-27 14:24:44.735 +08:00 [DBG] Connection id "0HLVAEEMM6ODJ" accepted.
2020-04-27 14:24:44.738 +08:00 [DBG] Connection id "0HLVAEEMM6ODK" started.
2020-04-27 14:24:44.738 +08:00 [DBG] Connection id "0HLVAEEMM6ODJ" started.
2020-04-27 14:24:44.748 +08:00 [DBG] queryContext => new QueryingEnumerable<HealthCheckConfiguration>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache, 
    null, 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, int[], ResultCoordinator, HealthCheckConfiguration>, 
    HealthChecks.UI.Core.Data.HealthChecksDb, 
    DiagnosticsLogger<Query>
)
2020-04-27 14:24:44.752 +08:00 [DBG] Connection id "0HLVAEEMM6ODJ" received FIN.
2020-04-27 14:24:44.752 +08:00 [DBG] Connection id "0HLVAEEMM6ODK" received FIN.
2020-04-27 14:24:44.757 +08:00 [DBG] Connection id "0HLVAEEMM6ODK" disconnecting.
2020-04-27 14:24:44.757 +08:00 [DBG] Connection id "0HLVAEEMM6ODJ" disconnecting.
2020-04-27 14:24:44.772 +08:00 [DBG] Connection id "0HLVAEEMM6ODJ" sending FIN because: "The client closed the connection."
2020-04-27 14:24:44.772 +08:00 [DBG] Connection id "0HLVAEEMM6ODK" sending FIN because: "The client closed the connection."
2020-04-27 14:24:44.773 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:24:44.777 +08:00 [DBG] Connection id "0HLVAEEMM6ODJ" stopped.
2020-04-27 14:24:44.777 +08:00 [DBG] Connection id "0HLVAEEMM6ODK" stopped.
2020-04-27 14:24:44.783 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:24:44.785 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:24:44.787 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:24:44.792 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:24:44.799 +08:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:24:44.805 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:24:44.810 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:24:44.812 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:24:44.814 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:24:44.821 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 14:24:44.827 +08:00 [VRB] Request Headers:

2020-04-27 14:24:44.830 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 14:24:44.831 +08:00 [VRB] Request Headers:

2020-04-27 14:24:44.862 +08:00 [DBG] Connection id "0HLVAEEMM6ODL" accepted.
2020-04-27 14:24:44.863 +08:00 [DBG] Connection id "0HLVAEEMM6ODL" started.
2020-04-27 14:24:44.865 +08:00 [INF] Application started. Press Ctrl+C to shut down.
2020-04-27 14:24:44.865 +08:00 [INF] Hosting environment: Development
2020-04-27 14:24:44.867 +08:00 [INF] Content root path: F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api
2020-04-27 14:24:44.869 +08:00 [DBG] Hosting started
2020-04-27 14:24:44.886 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 14:24:44.889 +08:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2020-04-27 14:24:44.890 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:24:44.893 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 14:24:44.957 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 14:24:44.964 +08:00 [DBG] Running health checks
2020-04-27 14:24:44.968 +08:00 [DBG] Running health check redis
2020-04-27 14:24:48.120 +08:00 [DBG] Connection id "0HLVAEEMM6ODM" accepted.
2020-04-27 14:24:48.120 +08:00 [DBG] Connection id "0HLVAEEMM6ODM" started.
2020-04-27 14:24:48.125 +08:00 [DBG] Connection id "0HLVAEEMM6ODN" accepted.
2020-04-27 14:24:48.125 +08:00 [DBG] Connection id "0HLVAEEMM6ODN" started.
2020-04-27 14:24:48.131 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/docs/index.html  
2020-04-27 14:24:48.131 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:24:48.146 +08:00 [DBG] The request path /docs/index.html does not match an existing file
2020-04-27 14:24:48.148 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 14:24:48.166 +08:00 [DBG] No candidates found for the request path '/docs/index.html'
2020-04-27 14:24:48.167 +08:00 [DBG] Request did not match any endpoints
2020-04-27 14:24:48.184 +08:00 [DBG] Connection id "0HLVAEEMM6ODM" completed keep alive response.
2020-04-27 14:24:48.190 +08:00 [INF] Request finished in 58.0286ms 404 
2020-04-27 14:25:00.216 +08:00 [ERR] Health check redis completed after 15244.6961ms with status "Unhealthy" and 'null'
2020-04-27 14:25:00.225 +08:00 [DBG] Health check processing completed after 15258.7584ms with combined status "Unhealthy"
2020-04-27 14:25:00.239 +08:00 [DBG] Connection id "0HLVAEEMM6ODL" completed keep alive response.
2020-04-27 14:25:00.240 +08:00 [INF] Request finished in 15354.9321ms 503 application/json
2020-04-27 14:25:00.264 +08:00 [INF] Received HTTP response after 15431.7279ms - "ServiceUnavailable"
2020-04-27 14:25:00.270 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:24:59 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:25:00.272 +08:00 [INF] End processing HTTP request after 15452.7381ms - "ServiceUnavailable"
2020-04-27 14:25:00.272 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:24:59 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:25:00.481 +08:00 [DBG] queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<HealthCheckFailureNotification>(
    asyncEnumerable: new QueryingEnumerable<HealthCheckFailureNotification>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache, 
        null, 
        null, 
        Func<QueryContext, DbDataReader, ResultContext, int[], ResultCoordinator, HealthCheckFailureNotification>, 
        HealthChecks.UI.Core.Data.HealthChecksDb, 
        DiagnosticsLogger<Query>
    ), 
    cancellationToken: queryContext.CancellationToken)
2020-04-27 14:25:00.511 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:25:00.511 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:25:00.511 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:00.513 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:00.519 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:25:00.521 +08:00 [INF] Executed DbCommand (7ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:25:00.522 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:25:00.522 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:00.526 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:00.538 +08:00 [DBG] 'HealthChecksDb' generated a temporary value for the 'Id' property of new 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:00.547 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:00.547 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 14:25:00.548 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 14:25:00.559 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 14:25:00.559 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:00.562 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:00.563 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 14:25:00.566 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 14:25:00.568 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:25:00.569 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:25:00.571 +08:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 10), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Failures" ("HealthCheckName", "IsUpAndRunning", "LastNotified")
VALUES (@p0, @p1, @p2);
SELECT "Id"
FROM "Failures"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 14:25:00.573 +08:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 10), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Failures" ("HealthCheckName", "IsUpAndRunning", "LastNotified")
VALUES (@p0, @p1, @p2);
SELECT "Id"
FROM "Failures"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 14:25:00.575 +08:00 [DBG] Foreign key property 'HealthCheckFailureNotification.Id' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:25:00.576 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:25:00.576 +08:00 [DBG] Committing transaction.
2020-04-27 14:25:00.606 +08:00 [DBG] Committing transaction.
2020-04-27 14:25:00.606 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:00.618 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:00.619 +08:00 [DBG] Disposing transaction.
2020-04-27 14:25:00.626 +08:00 [DBG] An 'HealthCheckFailureNotification' entity tracked by 'HealthChecksDb' changed from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:00.626 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 1 entities written to the database.
2020-04-27 14:25:00.631 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 14:25:00.672 +08:00 [DBG] queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<HealthCheckExecution>(
    asyncEnumerable: new QueryingEnumerable<HealthCheckExecution>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache, 
        null, 
        null, 
        Func<QueryContext, DbDataReader, ResultContext, int[], ResultCoordinator, HealthCheckExecution>, 
        HealthChecks.UI.Core.Data.HealthChecksDb, 
        DiagnosticsLogger<Query>
    ), 
    cancellationToken: queryContext.CancellationToken)
2020-04-27 14:25:00.674 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:25:00.674 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:25:00.674 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:00.675 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:00.675 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:25:00.680 +08:00 [INF] Executed DbCommand (5ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:25:00.680 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:25:00.680 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:00.683 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:00.683 +08:00 [DBG] Creating a new HealthReport history.
2020-04-27 14:25:00.693 +08:00 [DBG] 'HealthChecksDb' generated a temporary value for the 'Id' property of new 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:00.709 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:00.714 +08:00 [DBG] 'HealthChecksDb' generated a temporary value for the 'Id' property of new 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:00.726 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:00.726 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 14:25:00.727 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 14:25:00.738 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 14:25:00.739 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:00.740 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:00.740 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 14:25:00.745 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 14:25:00.749 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:25:00.749 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:25:00.751 +08:00 [DBG] Executing DbCommand [Parameters=[@p0='?', @p1='?', @p2='?' (Size = 10), @p3='?', @p4='?', @p5='?' (Size = 7)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Executions" ("DiscoveryService", "LastExecuted", "Name", "OnStateFrom", "Status", "Uri")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
SELECT "Id"
FROM "Executions"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 14:25:00.753 +08:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?', @p1='?', @p2='?' (Size = 10), @p3='?', @p4='?', @p5='?' (Size = 7)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Executions" ("DiscoveryService", "LastExecuted", "Name", "OnStateFrom", "Status", "Uri")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
SELECT "Id"
FROM "Executions"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 14:25:00.755 +08:00 [DBG] Foreign key property 'HealthCheckExecution.Id' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:25:00.780 +08:00 [DBG] Foreign key property 'HealthCheckExecutionEntry.HealthCheckExecutionId' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:25:00.783 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:25:00.784 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:25:00.784 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:25:00.784 +08:00 [DBG] Executing DbCommand [Parameters=[@p6='?' (Size = 342), @p7='?', @p8='?', @p9='?' (Size = 5), @p10='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "HealthCheckExecutionEntries" ("Description", "Duration", "HealthCheckExecutionId", "Name", "Status")
VALUES (@p6, @p7, @p8, @p9, @p10);
SELECT "Id"
FROM "HealthCheckExecutionEntries"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 14:25:00.787 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@p6='?' (Size = 342), @p7='?', @p8='?', @p9='?' (Size = 5), @p10='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "HealthCheckExecutionEntries" ("Description", "Duration", "HealthCheckExecutionId", "Name", "Status")
VALUES (@p6, @p7, @p8, @p9, @p10);
SELECT "Id"
FROM "HealthCheckExecutionEntries"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 14:25:00.789 +08:00 [DBG] Foreign key property 'HealthCheckExecutionEntry.Id' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:25:00.790 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:25:00.790 +08:00 [DBG] Committing transaction.
2020-04-27 14:25:00.817 +08:00 [DBG] Committing transaction.
2020-04-27 14:25:00.817 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:00.830 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:00.830 +08:00 [DBG] Disposing transaction.
2020-04-27 14:25:00.834 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:00.836 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:00.836 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 14:25:00.836 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 14:25:00.839 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 14:25:00.840 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 14:25:10.850 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 14:25:10.876 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 14:25:10.879 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:25:10.880 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2020-04-27 14:25:10.880 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:10.882 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:10.884 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:25:10.886 +08:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:25:10.888 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:10.889 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:25:10.890 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:10.891 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:10.893 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 14:25:10.893 +08:00 [VRB] Request Headers:

2020-04-27 14:25:10.894 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 14:25:10.895 +08:00 [VRB] Request Headers:

2020-04-27 14:25:10.917 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 14:25:10.917 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:25:10.918 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 14:25:10.921 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 14:25:10.922 +08:00 [DBG] Running health checks
2020-04-27 14:25:10.923 +08:00 [DBG] Running health check redis
2020-04-27 14:25:14.560 +08:00 [DBG] Connection id "0HLVAEEMM6ODN" received FIN.
2020-04-27 14:25:14.560 +08:00 [DBG] Connection id "0HLVAEEMM6ODO" accepted.
2020-04-27 14:25:14.561 +08:00 [DBG] Connection id "0HLVAEEMM6ODN" disconnecting.
2020-04-27 14:25:14.562 +08:00 [DBG] Connection id "0HLVAEEMM6ODN" sending FIN because: "The client closed the connection."
2020-04-27 14:25:14.562 +08:00 [DBG] Connection id "0HLVAEEMM6ODO" started.
2020-04-27 14:25:14.567 +08:00 [DBG] Connection id "0HLVAEEMM6ODN" stopped.
2020-04-27 14:25:14.572 +08:00 [DBG] Connection id "0HLVAEEMM6ODO" bad request data: "Invalid request line: '\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03!\x07k\xB3\xFAKYI\xDF\xF3\xCE\x88YQ\x12\xA5\xB9j5\xD8\xE1M\xD5U$\xBD:"\x8D\x92t\xE4 !<\x8C\x90\x8C\xABd\xC8\x97\x0A'"
Microsoft.AspNetCore.Server.Kestrel.Core.BadHttpRequestException: Invalid request line: '\x16\x03\x01\x02\x00\x01\x00\x01\xFC\x03\x03!\x07k\xB3\xFAKYI\xDF\xF3\xCE\x88YQ\x12\xA5\xB9j5\xD8\xE1M\xD5U$\xBD:"\x8D\x92t\xE4 !<\x8C\x90\x8C\xABd\xC8\x97\x0A'
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpParser`1.RejectRequestLine(Byte* requestLine, Int32 length)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpParser`1.GetUnknownMethod(Byte* data, Int32 length, Int32& methodLength)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpParser`1.ParseRequestLine(TRequestHandler handler, Byte* data, Int32 length)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpParser`1.ParseRequestLine(TRequestHandler handler, ReadOnlySequence`1& buffer, SequencePosition& consumed, SequencePosition& examined)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpParser`1.Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.IHttpParser<TRequestHandler>.ParseRequestLine(TRequestHandler handler, ReadOnlySequence`1& buffer, SequencePosition& consumed, SequencePosition& examined)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1Connection.TakeStartLine(ReadOnlySequence`1& buffer, SequencePosition& consumed, SequencePosition& examined)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1Connection.ParseRequest(ReadOnlySequence`1& buffer, SequencePosition& consumed, SequencePosition& examined)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.Http1Connection.TryParseRequest(ReadResult result, Boolean& endConnection)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequests[TContext](IHttpApplication`1 application)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.ProcessRequestsAsync[TContext](IHttpApplication`1 application)
2020-04-27 14:25:14.610 +08:00 [DBG] Connection id "0HLVAEEMM6ODO" disconnecting.
2020-04-27 14:25:14.610 +08:00 [DBG] Connection id "0HLVAEEMM6ODO" stopped.
2020-04-27 14:25:14.617 +08:00 [DBG] Connection id "0HLVAEEMM6ODO" sending FIN because: "The Socket transport's send loop completed gracefully."
2020-04-27 14:25:20.977 +08:00 [ERR] Health check redis completed after 10054.5959ms with status "Unhealthy" and 'null'
2020-04-27 14:25:20.978 +08:00 [DBG] Health check processing completed after 10055.2264ms with combined status "Unhealthy"
2020-04-27 14:25:20.979 +08:00 [DBG] Connection id "0HLVAEEMM6ODL" completed keep alive response.
2020-04-27 14:25:20.979 +08:00 [INF] Request finished in 10062.0817ms 503 application/json
2020-04-27 14:25:20.992 +08:00 [INF] Received HTTP response after 10098.4376ms - "ServiceUnavailable"
2020-04-27 14:25:20.995 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:25:20 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:25:20.996 +08:00 [INF] End processing HTTP request after 10103.1373ms - "ServiceUnavailable"
2020-04-27 14:25:20.998 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:25:20 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:25:21.005 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:25:21.005 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:25:21.007 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:21.008 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:21.011 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:25:21.015 +08:00 [INF] Executed DbCommand (7ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:25:21.020 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:21.022 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:25:21.024 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:21.025 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:21.027 +08:00 [INF] Notification is sent on same window time.
2020-04-27 14:25:21.027 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 14:25:21.033 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:25:21.033 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:25:21.033 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:21.035 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:21.037 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:25:21.042 +08:00 [INF] Executed DbCommand (4ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:25:21.044 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:21.059 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:21.061 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:25:21.062 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:21.066 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:21.066 +08:00 [DBG] HealthReport history already exists and is in the same state, updating the values.
2020-04-27 14:25:21.069 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 14:25:21.069 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 14:25:21.074 +08:00 [DBG] Unchanged 'HealthCheckExecution.LastExecuted' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:25:21.076 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:21.076 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Description' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:25:21.076 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:21.076 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Duration' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:25:21.076 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 14:25:21.076 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:21.078 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:21.079 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 14:25:21.081 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 14:25:21.100 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:25:21.100 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:25:21.101 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:25:21.104 +08:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:25:21.110 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:25:21.112 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:25:21.112 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:25:21.113 +08:00 [DBG] Executing DbCommand [Parameters=[@p2='?', @p0='?' (Size = 343), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 14:25:21.114 +08:00 [INF] Executed DbCommand (0ms) [Parameters=[@p2='?', @p0='?' (Size = 343), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 14:25:21.115 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:25:21.116 +08:00 [DBG] Committing transaction.
2020-04-27 14:25:21.143 +08:00 [DBG] Committing transaction.
2020-04-27 14:25:21.144 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:21.157 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:21.159 +08:00 [DBG] Disposing transaction.
2020-04-27 14:25:21.159 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:21.159 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:21.159 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 14:25:21.159 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 14:25:21.159 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 14:25:21.159 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 14:25:26.178 +08:00 [DBG] Connection id "0HLVAEEMM6ODP" accepted.
2020-04-27 14:25:26.179 +08:00 [DBG] Connection id "0HLVAEEMM6ODP" started.
2020-04-27 14:25:26.183 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/swagger/index.html  
2020-04-27 14:25:26.184 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:25:26.186 +08:00 [DBG] The request path /swagger/index.html does not match an existing file
2020-04-27 14:25:26.208 +08:00 [DBG] Connection id "0HLVAEEMM6ODM" completed keep alive response.
2020-04-27 14:25:26.210 +08:00 [INF] Request finished in 24.9969ms 200 text/html;charset=utf-8
2020-04-27 14:25:26.241 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/swagger/swagger-ui.css  
2020-04-27 14:25:26.241 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:25:26.243 +08:00 [DBG] The request path /swagger/swagger-ui.css does not match an existing file
2020-04-27 14:25:26.244 +08:00 [DBG] Connection id "0HLVAEEMM6ODQ" accepted.
2020-04-27 14:25:26.245 +08:00 [DBG] Connection id "0HLVAEEMM6ODQ" started.
2020-04-27 14:25:26.246 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/custom.css  
2020-04-27 14:25:26.246 +08:00 [DBG] Connection id "0HLVAEEMM6ODR" accepted.
2020-04-27 14:25:26.246 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:25:26.246 +08:00 [DBG] Connection id "0HLVAEEMM6ODR" started.
2020-04-27 14:25:26.246 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/swagger/swagger-ui-standalone-preset.js  
2020-04-27 14:25:26.246 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:25:26.246 +08:00 [DBG] The request path /swagger/swagger-ui-standalone-preset.js does not match an existing file
2020-04-27 14:25:26.246 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/swagger/swagger-ui-bundle.js  
2020-04-27 14:25:26.246 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:25:26.247 +08:00 [DBG] The request path /swagger/swagger-ui-bundle.js does not match an existing file
2020-04-27 14:25:26.292 +08:00 [VRB] Range header's value is empty.
2020-04-27 14:25:26.292 +08:00 [VRB] Range header's value is empty.
2020-04-27 14:25:26.292 +08:00 [VRB] Range header's value is empty.
2020-04-27 14:25:26.292 +08:00 [VRB] Range header's value is empty.
2020-04-27 14:25:26.296 +08:00 [INF] The file /swagger-ui-bundle.js was not modified
2020-04-27 14:25:26.296 +08:00 [INF] The file /swagger-ui-standalone-preset.js was not modified
2020-04-27 14:25:26.296 +08:00 [INF] The file /custom.css was not modified
2020-04-27 14:25:26.296 +08:00 [INF] The file /swagger-ui.css was not modified
2020-04-27 14:25:26.305 +08:00 [DBG] Handled. Status code: 304 File: /swagger-ui.css
2020-04-27 14:25:26.305 +08:00 [DBG] Handled. Status code: 304 File: /swagger-ui-bundle.js
2020-04-27 14:25:26.305 +08:00 [DBG] Handled. Status code: 304 File: /swagger-ui-standalone-preset.js
2020-04-27 14:25:26.305 +08:00 [DBG] Handled. Status code: 304 File: /custom.css
2020-04-27 14:25:26.305 +08:00 [DBG] Connection id "0HLVAEEMM6ODP" completed keep alive response.
2020-04-27 14:25:26.305 +08:00 [DBG] Connection id "0HLVAEEMM6ODR" completed keep alive response.
2020-04-27 14:25:26.305 +08:00 [DBG] Connection id "0HLVAEEMM6ODQ" completed keep alive response.
2020-04-27 14:25:26.305 +08:00 [INF] Request finished in 59.121ms 304 application/javascript
2020-04-27 14:25:26.305 +08:00 [INF] Request finished in 59.0017ms 304 application/javascript
2020-04-27 14:25:26.305 +08:00 [INF] Request finished in 59.7647ms 304 text/css
2020-04-27 14:25:26.305 +08:00 [DBG] Connection id "0HLVAEEMM6ODM" completed keep alive response.
2020-04-27 14:25:26.310 +08:00 [INF] Request finished in 68.9504ms 304 text/css
2020-04-27 14:25:26.468 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/docs/v1/docs.json  
2020-04-27 14:25:26.468 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:25:26.469 +08:00 [DBG] The request path /docs/v1/docs.json does not match an existing file
2020-04-27 14:25:26.575 +08:00 [DBG] Connection id "0HLVAEEMM6ODM" completed keep alive response.
2020-04-27 14:25:26.575 +08:00 [INF] Request finished in 107.5304ms 200 application/json;charset=utf-8
2020-04-27 14:25:31.167 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 14:25:31.171 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 14:25:31.173 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:25:31.175 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2020-04-27 14:25:31.175 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:31.177 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:31.177 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:25:31.181 +08:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:25:31.182 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:31.182 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:25:31.182 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:31.183 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:31.183 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 14:25:31.186 +08:00 [VRB] Request Headers:

2020-04-27 14:25:31.186 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 14:25:31.186 +08:00 [VRB] Request Headers:

2020-04-27 14:25:31.204 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 14:25:31.205 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:25:31.205 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 14:25:31.205 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 14:25:31.205 +08:00 [DBG] Running health checks
2020-04-27 14:25:31.207 +08:00 [DBG] Running health check redis
2020-04-27 14:25:41.242 +08:00 [ERR] Health check redis completed after 10035.4664ms with status "Unhealthy" and 'null'
2020-04-27 14:25:41.243 +08:00 [DBG] Health check processing completed after 10037.7381ms with combined status "Unhealthy"
2020-04-27 14:25:41.244 +08:00 [DBG] Connection id "0HLVAEEMM6ODL" completed keep alive response.
2020-04-27 14:25:41.244 +08:00 [INF] Request finished in 10039.3075ms 503 application/json
2020-04-27 14:25:41.256 +08:00 [INF] Received HTTP response after 10070.4804ms - "ServiceUnavailable"
2020-04-27 14:25:41.258 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:25:40 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:25:41.259 +08:00 [INF] End processing HTTP request after 10075.4345ms - "ServiceUnavailable"
2020-04-27 14:25:41.259 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:25:40 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:25:41.263 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:25:41.264 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:25:41.265 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:41.266 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:41.268 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:25:41.271 +08:00 [INF] Executed DbCommand (4ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:25:41.272 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:41.274 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:25:41.275 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:41.277 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:41.277 +08:00 [INF] Notification is sent on same window time.
2020-04-27 14:25:41.277 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 14:25:41.282 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:25:41.283 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:25:41.284 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:41.285 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:41.285 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:25:41.289 +08:00 [INF] Executed DbCommand (4ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:25:41.291 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:41.293 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:41.294 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:25:41.295 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:41.297 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:41.299 +08:00 [DBG] HealthReport history already exists and is in the same state, updating the values.
2020-04-27 14:25:41.299 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 14:25:41.301 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 14:25:41.305 +08:00 [DBG] Unchanged 'HealthCheckExecution.LastExecuted' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:25:41.306 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:41.306 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Description' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:25:41.306 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:41.307 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Duration' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:25:41.307 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 14:25:41.309 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:41.311 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:41.311 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 14:25:41.315 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 14:25:41.322 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:25:41.323 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:25:41.323 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:25:41.328 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:25:41.329 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:25:41.330 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:25:41.331 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:25:41.331 +08:00 [DBG] Executing DbCommand [Parameters=[@p2='?', @p0='?' (Size = 343), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 14:25:41.332 +08:00 [INF] Executed DbCommand (0ms) [Parameters=[@p2='?', @p0='?' (Size = 343), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 14:25:41.332 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:25:41.332 +08:00 [DBG] Committing transaction.
2020-04-27 14:25:41.357 +08:00 [DBG] Committing transaction.
2020-04-27 14:25:41.358 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:41.369 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:41.369 +08:00 [DBG] Disposing transaction.
2020-04-27 14:25:41.370 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:41.370 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:41.371 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 14:25:41.371 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 14:25:41.371 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 14:25:41.372 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 14:25:45.123 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/docs/v1/docs.json  
2020-04-27 14:25:45.124 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:25:45.125 +08:00 [DBG] The request path /docs/v1/docs.json does not match an existing file
2020-04-27 14:25:45.133 +08:00 [DBG] Connection id "0HLVAEEMM6ODM" completed keep alive response.
2020-04-27 14:25:45.134 +08:00 [INF] Request finished in 10.1575ms 200 application/json;charset=utf-8
2020-04-27 14:25:51.387 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 14:25:51.391 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 14:25:51.392 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:25:51.393 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2020-04-27 14:25:51.393 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:51.395 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:51.396 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:25:51.398 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:25:51.400 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:25:51.401 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:25:51.403 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:51.405 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:25:51.406 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 14:25:51.406 +08:00 [VRB] Request Headers:

2020-04-27 14:25:51.406 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 14:25:51.406 +08:00 [VRB] Request Headers:

2020-04-27 14:25:51.422 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 14:25:51.422 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:25:51.423 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 14:25:51.425 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 14:25:51.426 +08:00 [DBG] Running health checks
2020-04-27 14:25:51.427 +08:00 [DBG] Running health check redis
2020-04-27 14:26:06.553 +08:00 [ERR] Health check redis completed after 15127.0879ms with status "Unhealthy" and 'null'
2020-04-27 14:26:06.553 +08:00 [DBG] Health check processing completed after 15127.3516ms with combined status "Unhealthy"
2020-04-27 14:26:06.554 +08:00 [DBG] Connection id "0HLVAEEMM6ODL" completed keep alive response.
2020-04-27 14:26:06.554 +08:00 [INF] Request finished in 15132.387ms 503 application/json
2020-04-27 14:26:06.566 +08:00 [INF] Received HTTP response after 15159.55ms - "ServiceUnavailable"
2020-04-27 14:26:06.567 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:26:05 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:26:06.567 +08:00 [INF] End processing HTTP request after 15160.556ms - "ServiceUnavailable"
2020-04-27 14:26:06.570 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:26:05 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:26:06.573 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:26:06.573 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:26:06.575 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:06.576 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:06.577 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:26:06.580 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:26:06.584 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:06.586 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:26:06.587 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:06.594 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:06.600 +08:00 [DBG] 'HealthChecksDb' generated a temporary value for the 'Id' property of new 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:06.602 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:06.602 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 14:26:06.604 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 14:26:06.606 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 14:26:06.607 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:06.609 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:06.609 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 14:26:06.612 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 14:26:06.614 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:26:06.615 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:26:06.618 +08:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 10), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Failures" ("HealthCheckName", "IsUpAndRunning", "LastNotified")
VALUES (@p0, @p1, @p2);
SELECT "Id"
FROM "Failures"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 14:26:06.620 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 10), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Failures" ("HealthCheckName", "IsUpAndRunning", "LastNotified")
VALUES (@p0, @p1, @p2);
SELECT "Id"
FROM "Failures"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 14:26:06.622 +08:00 [DBG] Foreign key property 'HealthCheckFailureNotification.Id' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:26:06.624 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:26:06.624 +08:00 [DBG] Committing transaction.
2020-04-27 14:26:06.660 +08:00 [DBG] Committing transaction.
2020-04-27 14:26:06.660 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:06.672 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:06.672 +08:00 [DBG] Disposing transaction.
2020-04-27 14:26:06.675 +08:00 [DBG] An 'HealthCheckFailureNotification' entity tracked by 'HealthChecksDb' changed from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:06.675 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 1 entities written to the database.
2020-04-27 14:26:06.675 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 14:26:06.681 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:26:06.681 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:26:06.681 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:06.682 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:06.682 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:26:06.689 +08:00 [INF] Executed DbCommand (6ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:26:06.690 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:06.692 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:06.693 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:26:06.693 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:06.695 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:06.696 +08:00 [DBG] HealthReport history already exists and is in the same state, updating the values.
2020-04-27 14:26:06.697 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 14:26:06.697 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 14:26:06.697 +08:00 [DBG] Unchanged 'HealthCheckExecution.LastExecuted' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:26:06.698 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:06.703 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Description' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:26:06.703 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:06.704 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Duration' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:26:06.705 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 14:26:06.705 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:06.706 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:06.706 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 14:26:06.711 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 14:26:06.718 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:26:06.719 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:26:06.719 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:26:06.722 +08:00 [INF] Executed DbCommand (2ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:26:06.722 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:26:06.722 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:26:06.722 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:26:06.723 +08:00 [DBG] Executing DbCommand [Parameters=[@p2='?', @p0='?' (Size = 54), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 14:26:06.725 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@p2='?', @p0='?' (Size = 54), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 14:26:06.726 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:26:06.726 +08:00 [DBG] Committing transaction.
2020-04-27 14:26:06.760 +08:00 [DBG] Committing transaction.
2020-04-27 14:26:06.760 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:06.773 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:06.773 +08:00 [DBG] Disposing transaction.
2020-04-27 14:26:06.775 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:06.775 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:06.775 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 14:26:06.775 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 14:26:06.776 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 14:26:06.776 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 14:26:16.785 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 14:26:16.789 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 14:26:16.791 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:26:16.793 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2020-04-27 14:26:16.793 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:16.794 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:16.796 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:26:16.802 +08:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:26:16.803 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:16.805 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:26:16.805 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:16.807 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:16.807 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 14:26:16.808 +08:00 [VRB] Request Headers:

2020-04-27 14:26:16.808 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 14:26:16.808 +08:00 [VRB] Request Headers:

2020-04-27 14:26:16.823 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 14:26:16.824 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:26:16.825 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 14:26:16.825 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 14:26:16.826 +08:00 [DBG] Running health checks
2020-04-27 14:26:16.828 +08:00 [DBG] Running health check redis
2020-04-27 14:26:31.961 +08:00 [ERR] Health check redis completed after 15133.044ms with status "Unhealthy" and 'null'
2020-04-27 14:26:31.962 +08:00 [DBG] Health check processing completed after 15135.4338ms with combined status "Unhealthy"
2020-04-27 14:26:31.963 +08:00 [DBG] Connection id "0HLVAEEMM6ODL" completed keep alive response.
2020-04-27 14:26:31.964 +08:00 [INF] Request finished in 15141.3011ms 503 application/json
2020-04-27 14:26:31.976 +08:00 [INF] Received HTTP response after 15168.1382ms - "ServiceUnavailable"
2020-04-27 14:26:31.978 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:26:31 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:26:31.979 +08:00 [INF] End processing HTTP request after 15170.8668ms - "ServiceUnavailable"
2020-04-27 14:26:31.980 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:26:31 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:26:31.985 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:26:31.985 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:26:31.987 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:31.988 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:31.989 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:26:31.991 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:26:31.993 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:31.995 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:26:31.996 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:32.004 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:32.005 +08:00 [INF] Notification is sent on same window time.
2020-04-27 14:26:32.005 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 14:26:32.009 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:26:32.009 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:26:32.011 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:32.013 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:32.013 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:26:32.016 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:26:32.018 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:32.020 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:32.021 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:26:32.024 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:32.025 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:32.025 +08:00 [DBG] HealthReport history already exists and is in the same state, updating the values.
2020-04-27 14:26:32.025 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 14:26:32.025 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 14:26:32.029 +08:00 [DBG] Unchanged 'HealthCheckExecution.LastExecuted' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:26:32.030 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:32.035 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Duration' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:26:32.036 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:32.038 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 14:26:32.042 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:32.043 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:32.043 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 14:26:32.052 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 14:26:32.055 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:26:32.056 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:26:32.057 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:26:32.057 +08:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:26:32.057 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:26:32.059 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:26:32.059 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:26:32.059 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Duration" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:26:32.059 +08:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Duration" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:26:32.060 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:26:32.060 +08:00 [DBG] Committing transaction.
2020-04-27 14:26:32.086 +08:00 [DBG] Committing transaction.
2020-04-27 14:26:32.087 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:32.099 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:32.099 +08:00 [DBG] Disposing transaction.
2020-04-27 14:26:32.101 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:32.101 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:32.101 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 14:26:32.101 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 14:26:32.102 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 14:26:32.104 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 14:26:42.110 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 14:26:42.111 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 14:26:42.112 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:26:42.113 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:26:42.113 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:42.115 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:42.115 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:26:42.120 +08:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:26:42.121 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:42.122 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:26:42.122 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:42.125 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:42.126 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 14:26:42.126 +08:00 [VRB] Request Headers:

2020-04-27 14:26:42.126 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 14:26:42.126 +08:00 [VRB] Request Headers:

2020-04-27 14:26:42.138 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 14:26:42.138 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:26:42.138 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 14:26:42.139 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 14:26:42.139 +08:00 [DBG] Running health checks
2020-04-27 14:26:42.140 +08:00 [DBG] Running health check redis
2020-04-27 14:26:44.656 +08:00 [DBG] HttpMessageHandler expired after 120000ms for client 'health-checks'
2020-04-27 14:26:44.656 +08:00 [DBG] HttpMessageHandler expired after 120000ms for client 'health-checks-webhooks'
2020-04-27 14:26:54.675 +08:00 [DBG] Starting HttpMessageHandler cleanup cycle with 2 items
2020-04-27 14:26:54.680 +08:00 [DBG] Ending HttpMessageHandler cleanup cycle after 0.007ms - processed: 0 items - remaining: 2 items
2020-04-27 14:26:57.256 +08:00 [ERR] Health check redis completed after 15116.3271ms with status "Unhealthy" and 'null'
2020-04-27 14:26:57.256 +08:00 [DBG] Health check processing completed after 15117.191ms with combined status "Unhealthy"
2020-04-27 14:26:57.257 +08:00 [DBG] Connection id "0HLVAEEMM6ODL" completed keep alive response.
2020-04-27 14:26:57.257 +08:00 [INF] Request finished in 15118.7995ms 503 application/json
2020-04-27 14:26:57.290 +08:00 [INF] Received HTTP response after 15163.621ms - "ServiceUnavailable"
2020-04-27 14:26:57.290 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:26:56 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:26:57.290 +08:00 [INF] End processing HTTP request after 15164.4463ms - "ServiceUnavailable"
2020-04-27 14:26:57.290 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:26:56 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:26:57.296 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:26:57.296 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:26:57.297 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:57.297 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:57.297 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:26:57.302 +08:00 [INF] Executed DbCommand (4ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:26:57.302 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:57.304 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:26:57.304 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:57.306 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:57.306 +08:00 [INF] Notification is sent on same window time.
2020-04-27 14:26:57.306 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 14:26:57.307 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:26:57.307 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:26:57.307 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:57.307 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:57.307 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:26:57.309 +08:00 [INF] Executed DbCommand (2ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:26:57.309 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:57.311 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:57.311 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:26:57.311 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:57.314 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:57.315 +08:00 [DBG] HealthReport history already exists and is in the same state, updating the values.
2020-04-27 14:26:57.315 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 14:26:57.315 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 14:26:57.341 +08:00 [DBG] Unchanged 'HealthCheckExecution.LastExecuted' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:26:57.341 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:57.341 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Duration' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:26:57.341 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:57.343 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 14:26:57.343 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:57.344 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:57.345 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 14:26:57.349 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 14:26:57.357 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:26:57.357 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:26:57.357 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:26:57.359 +08:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:26:57.359 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:26:57.361 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:26:57.361 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:26:57.361 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Duration" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:26:57.361 +08:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Duration" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:26:57.361 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:26:57.361 +08:00 [DBG] Committing transaction.
2020-04-27 14:26:57.391 +08:00 [DBG] Committing transaction.
2020-04-27 14:26:57.392 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:57.403 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:26:57.403 +08:00 [DBG] Disposing transaction.
2020-04-27 14:26:57.404 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:57.404 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:26:57.404 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 14:26:57.404 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 14:26:57.404 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 14:26:57.404 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 14:27:04.684 +08:00 [DBG] Starting HttpMessageHandler cleanup cycle with 2 items
2020-04-27 14:27:04.685 +08:00 [DBG] Ending HttpMessageHandler cleanup cycle after 0.0078ms - processed: 0 items - remaining: 2 items
2020-04-27 14:27:07.404 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 14:27:07.407 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 14:27:07.408 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:27:07.409 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2020-04-27 14:27:07.409 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:07.411 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:07.412 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:27:07.415 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:27:07.417 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:27:07.419 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:27:07.421 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:07.423 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:07.423 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 14:27:07.423 +08:00 [VRB] Request Headers:

2020-04-27 14:27:07.423 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 14:27:07.423 +08:00 [VRB] Request Headers:

2020-04-27 14:27:07.441 +08:00 [DBG] Connection id "0HLVAEEMM6ODS" accepted.
2020-04-27 14:27:07.442 +08:00 [DBG] Connection id "0HLVAEEMM6ODS" started.
2020-04-27 14:27:07.446 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 14:27:07.446 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:27:07.447 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 14:27:07.451 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 14:27:07.452 +08:00 [DBG] Running health checks
2020-04-27 14:27:07.454 +08:00 [DBG] Running health check redis
2020-04-27 14:27:14.685 +08:00 [DBG] Starting HttpMessageHandler cleanup cycle with 2 items
2020-04-27 14:27:14.685 +08:00 [DBG] Ending HttpMessageHandler cleanup cycle after 0.0028ms - processed: 0 items - remaining: 2 items
2020-04-27 14:27:17.509 +08:00 [ERR] Health check redis completed after 10055.161ms with status "Unhealthy" and 'null'
2020-04-27 14:27:17.510 +08:00 [DBG] Health check processing completed after 10057.2683ms with combined status "Unhealthy"
2020-04-27 14:27:17.510 +08:00 [DBG] Connection id "0HLVAEEMM6ODS" completed keep alive response.
2020-04-27 14:27:17.510 +08:00 [INF] Request finished in 10064.0878ms 503 application/json
2020-04-27 14:27:17.525 +08:00 [INF] Received HTTP response after 10102.418ms - "ServiceUnavailable"
2020-04-27 14:27:17.526 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:27:16 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:27:17.527 +08:00 [INF] End processing HTTP request after 10104.0801ms - "ServiceUnavailable"
2020-04-27 14:27:17.527 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:27:16 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:27:17.534 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:27:17.534 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:27:17.536 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:17.537 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:17.538 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:27:17.540 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:27:17.542 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:27:17.543 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:27:17.544 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:17.548 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:17.548 +08:00 [DBG] 'HealthChecksDb' generated a temporary value for the 'Id' property of new 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:27:17.548 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:27:17.548 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 14:27:17.548 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 14:27:17.548 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 14:27:17.548 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:17.551 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:17.553 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 14:27:17.559 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 14:27:17.565 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:27:17.565 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:27:17.567 +08:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 10), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Failures" ("HealthCheckName", "IsUpAndRunning", "LastNotified")
VALUES (@p0, @p1, @p2);
SELECT "Id"
FROM "Failures"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 14:27:17.570 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 10), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Failures" ("HealthCheckName", "IsUpAndRunning", "LastNotified")
VALUES (@p0, @p1, @p2);
SELECT "Id"
FROM "Failures"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 14:27:17.571 +08:00 [DBG] Foreign key property 'HealthCheckFailureNotification.Id' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:27:17.573 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:27:17.574 +08:00 [DBG] Committing transaction.
2020-04-27 14:27:17.605 +08:00 [DBG] Committing transaction.
2020-04-27 14:27:17.606 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:17.618 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:17.618 +08:00 [DBG] Disposing transaction.
2020-04-27 14:27:17.622 +08:00 [DBG] An 'HealthCheckFailureNotification' entity tracked by 'HealthChecksDb' changed from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:27:17.622 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 1 entities written to the database.
2020-04-27 14:27:17.622 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 14:27:17.626 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:27:17.626 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:27:17.629 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:17.631 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:17.633 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:27:17.637 +08:00 [INF] Executed DbCommand (4ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:27:17.637 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:27:17.640 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:27:17.642 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:27:17.642 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:17.645 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:17.645 +08:00 [DBG] HealthReport history already exists and is in the same state, updating the values.
2020-04-27 14:27:17.646 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 14:27:17.646 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 14:27:17.646 +08:00 [DBG] Unchanged 'HealthCheckExecution.LastExecuted' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:27:17.646 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:27:17.646 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Description' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:27:17.646 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:27:17.646 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Duration' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:27:17.646 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 14:27:17.647 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:17.649 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:17.649 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 14:27:17.654 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 14:27:17.656 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:27:17.656 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:27:17.656 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:27:17.657 +08:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:27:17.657 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:27:17.657 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:27:17.657 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:27:17.657 +08:00 [DBG] Executing DbCommand [Parameters=[@p2='?', @p0='?' (Size = 344), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 14:27:17.657 +08:00 [INF] Executed DbCommand (0ms) [Parameters=[@p2='?', @p0='?' (Size = 344), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 14:27:17.657 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:27:17.657 +08:00 [DBG] Committing transaction.
2020-04-27 14:27:17.683 +08:00 [DBG] Committing transaction.
2020-04-27 14:27:17.684 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:17.696 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:17.696 +08:00 [DBG] Disposing transaction.
2020-04-27 14:27:17.696 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:27:17.696 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:27:17.696 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 14:27:17.696 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 14:27:17.696 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 14:27:17.696 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 14:27:24.685 +08:00 [DBG] Starting HttpMessageHandler cleanup cycle with 2 items
2020-04-27 14:27:24.685 +08:00 [DBG] Ending HttpMessageHandler cleanup cycle after 0.0034ms - processed: 0 items - remaining: 2 items
2020-04-27 14:27:27.707 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 14:27:27.710 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 14:27:27.712 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:27:27.712 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:27:27.713 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:27.715 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:27.716 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:27:27.718 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:27:27.720 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:27:27.721 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:27:27.722 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:27.726 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:27.728 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 14:27:27.728 +08:00 [VRB] Request Headers:

2020-04-27 14:27:27.728 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 14:27:27.730 +08:00 [VRB] Request Headers:

2020-04-27 14:27:27.746 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 14:27:27.747 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:27:27.747 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 14:27:27.749 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 14:27:27.749 +08:00 [DBG] Running health checks
2020-04-27 14:27:27.751 +08:00 [DBG] Running health check redis
2020-04-27 14:27:34.685 +08:00 [DBG] Starting HttpMessageHandler cleanup cycle with 2 items
2020-04-27 14:27:34.685 +08:00 [DBG] Ending HttpMessageHandler cleanup cycle after 0.0035ms - processed: 0 items - remaining: 2 items
2020-04-27 14:27:42.879 +08:00 [ERR] Health check redis completed after 15128.3711ms with status "Unhealthy" and 'null'
2020-04-27 14:27:42.880 +08:00 [DBG] Health check processing completed after 15130.3ms with combined status "Unhealthy"
2020-04-27 14:27:42.881 +08:00 [DBG] Connection id "0HLVAEEMM6ODS" completed keep alive response.
2020-04-27 14:27:42.881 +08:00 [INF] Request finished in 15135.5394ms 503 application/json
2020-04-27 14:27:42.892 +08:00 [INF] Received HTTP response after 15163.5999ms - "ServiceUnavailable"
2020-04-27 14:27:42.893 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:27:42 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:27:42.894 +08:00 [INF] End processing HTTP request after 15166.6004ms - "ServiceUnavailable"
2020-04-27 14:27:42.895 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:27:42 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:27:42.898 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:27:42.899 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:27:42.900 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:42.901 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:42.902 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:27:42.906 +08:00 [INF] Executed DbCommand (4ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:27:42.907 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:27:42.909 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:27:42.909 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:42.912 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:42.913 +08:00 [INF] Notification is sent on same window time.
2020-04-27 14:27:42.914 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 14:27:42.917 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:27:42.917 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:27:42.917 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:42.919 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:42.920 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:27:42.925 +08:00 [INF] Executed DbCommand (4ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:27:42.926 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:27:42.927 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:27:42.928 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:27:42.929 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:42.931 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:42.931 +08:00 [DBG] HealthReport history already exists and is in the same state, updating the values.
2020-04-27 14:27:42.932 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 14:27:42.933 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 14:27:42.934 +08:00 [DBG] Unchanged 'HealthCheckExecution.LastExecuted' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:27:42.937 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:27:42.937 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Description' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:27:42.938 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:27:42.939 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Duration' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:27:42.941 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 14:27:42.944 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:42.945 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:42.945 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 14:27:42.948 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 14:27:42.955 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:27:42.955 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:27:42.955 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:27:42.955 +08:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:27:42.955 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:27:42.956 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:27:42.956 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:27:42.956 +08:00 [DBG] Executing DbCommand [Parameters=[@p2='?', @p0='?' (Size = 54), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 14:27:42.956 +08:00 [INF] Executed DbCommand (0ms) [Parameters=[@p2='?', @p0='?' (Size = 54), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 14:27:42.956 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:27:42.956 +08:00 [DBG] Committing transaction.
2020-04-27 14:27:42.990 +08:00 [DBG] Committing transaction.
2020-04-27 14:27:42.990 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:43.002 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:43.003 +08:00 [DBG] Disposing transaction.
2020-04-27 14:27:43.005 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:27:43.007 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:27:43.007 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 14:27:43.007 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 14:27:43.008 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 14:27:43.009 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 14:27:44.686 +08:00 [DBG] Starting HttpMessageHandler cleanup cycle with 2 items
2020-04-27 14:27:44.686 +08:00 [DBG] Ending HttpMessageHandler cleanup cycle after 0.0038ms - processed: 0 items - remaining: 2 items
2020-04-27 14:27:53.022 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 14:27:53.025 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 14:27:53.026 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:27:53.026 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:27:53.026 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:53.027 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:53.027 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:27:53.032 +08:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:27:53.032 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:27:53.034 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:27:53.034 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:53.036 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:27:53.036 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 14:27:53.036 +08:00 [VRB] Request Headers:

2020-04-27 14:27:53.036 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 14:27:53.036 +08:00 [VRB] Request Headers:

2020-04-27 14:27:53.058 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 14:27:53.059 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:27:53.059 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 14:27:53.060 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 14:27:53.060 +08:00 [DBG] Running health checks
2020-04-27 14:27:53.060 +08:00 [DBG] Running health check redis
2020-04-27 14:27:54.699 +08:00 [DBG] Starting HttpMessageHandler cleanup cycle with 2 items
2020-04-27 14:27:54.699 +08:00 [DBG] Ending HttpMessageHandler cleanup cycle after 0.0031ms - processed: 0 items - remaining: 2 items
2020-04-27 14:28:03.143 +08:00 [ERR] Health check redis completed after 10082.5039ms with status "Unhealthy" and 'null'
2020-04-27 14:28:03.143 +08:00 [DBG] Health check processing completed after 10082.9513ms with combined status "Unhealthy"
2020-04-27 14:28:03.144 +08:00 [DBG] Connection id "0HLVAEEMM6ODS" completed keep alive response.
2020-04-27 14:28:03.144 +08:00 [INF] Request finished in 10085.6421ms 503 application/json
2020-04-27 14:28:03.158 +08:00 [INF] Received HTTP response after 10122.3922ms - "ServiceUnavailable"
2020-04-27 14:28:03.159 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:28:02 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:28:03.161 +08:00 [INF] End processing HTTP request after 10125.214ms - "ServiceUnavailable"
2020-04-27 14:28:03.163 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:28:02 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:28:03.167 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:28:03.167 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:28:03.169 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:03.171 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:03.172 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:28:03.176 +08:00 [INF] Executed DbCommand (5ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:28:03.179 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:03.181 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:28:03.183 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:03.184 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:03.184 +08:00 [INF] Notification is sent on same window time.
2020-04-27 14:28:03.184 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 14:28:03.192 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:28:03.192 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:28:03.193 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:03.194 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:03.194 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:28:03.201 +08:00 [INF] Executed DbCommand (7ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:28:03.203 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:03.204 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:03.206 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:28:03.208 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:03.210 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:03.211 +08:00 [DBG] HealthReport history already exists and is in the same state, updating the values.
2020-04-27 14:28:03.214 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 14:28:03.214 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 14:28:03.216 +08:00 [DBG] Unchanged 'HealthCheckExecution.LastExecuted' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:28:03.218 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:03.220 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Description' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:28:03.221 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:03.222 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Duration' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:28:03.224 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 14:28:03.226 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:03.229 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:03.229 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 14:28:03.232 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 14:28:03.234 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:28:03.234 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:28:03.236 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:28:03.240 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:28:03.241 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:28:03.243 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:28:03.243 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:28:03.245 +08:00 [DBG] Executing DbCommand [Parameters=[@p2='?', @p0='?' (Size = 344), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 14:28:03.245 +08:00 [INF] Executed DbCommand (1ms) [Parameters=[@p2='?', @p0='?' (Size = 344), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 14:28:03.245 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:28:03.245 +08:00 [DBG] Committing transaction.
2020-04-27 14:28:03.272 +08:00 [DBG] Committing transaction.
2020-04-27 14:28:03.272 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:03.284 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:03.285 +08:00 [DBG] Disposing transaction.
2020-04-27 14:28:03.285 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:03.285 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:03.285 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 14:28:03.285 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 14:28:03.285 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 14:28:03.285 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 14:28:04.705 +08:00 [DBG] Starting HttpMessageHandler cleanup cycle with 2 items
2020-04-27 14:28:04.705 +08:00 [DBG] Ending HttpMessageHandler cleanup cycle after 0.0051ms - processed: 0 items - remaining: 2 items
2020-04-27 14:28:13.284 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 14:28:13.285 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 14:28:13.285 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:28:13.285 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:28:13.285 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:13.285 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:13.285 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:28:13.289 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:28:13.289 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:13.289 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:28:13.290 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:13.293 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:13.293 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 14:28:13.293 +08:00 [VRB] Request Headers:

2020-04-27 14:28:13.293 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 14:28:13.293 +08:00 [VRB] Request Headers:

2020-04-27 14:28:13.306 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 14:28:13.306 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:28:13.306 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 14:28:13.312 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 14:28:13.312 +08:00 [DBG] Running health checks
2020-04-27 14:28:13.312 +08:00 [DBG] Running health check redis
2020-04-27 14:28:14.716 +08:00 [DBG] Starting HttpMessageHandler cleanup cycle with 2 items
2020-04-27 14:28:14.716 +08:00 [DBG] Ending HttpMessageHandler cleanup cycle after 0.0028ms - processed: 0 items - remaining: 2 items
2020-04-27 14:28:24.729 +08:00 [DBG] Starting HttpMessageHandler cleanup cycle with 2 items
2020-04-27 14:28:24.729 +08:00 [DBG] Ending HttpMessageHandler cleanup cycle after 0.0028ms - processed: 0 items - remaining: 2 items
2020-04-27 14:28:28.435 +08:00 [ERR] Health check redis completed after 15122.7297ms with status "Unhealthy" and 'null'
2020-04-27 14:28:28.435 +08:00 [DBG] Health check processing completed after 15122.9973ms with combined status "Unhealthy"
2020-04-27 14:28:28.437 +08:00 [DBG] Connection id "0HLVAEEMM6ODS" completed keep alive response.
2020-04-27 14:28:28.437 +08:00 [INF] Request finished in 15131.0862ms 503 application/json
2020-04-27 14:28:28.448 +08:00 [INF] Received HTTP response after 15154.6616ms - "ServiceUnavailable"
2020-04-27 14:28:28.450 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:28:27 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:28:28.450 +08:00 [INF] End processing HTTP request after 15156.7599ms - "ServiceUnavailable"
2020-04-27 14:28:28.453 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:28:27 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:28:28.455 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:28:28.456 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:28:28.457 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:28.458 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:28.459 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:28:28.463 +08:00 [INF] Executed DbCommand (5ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:28:28.466 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:28.467 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:28:28.469 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:28.472 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:28.475 +08:00 [DBG] 'HealthChecksDb' generated a temporary value for the 'Id' property of new 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:28.476 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:28.478 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 14:28:28.478 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 14:28:28.480 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 14:28:28.481 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:28.483 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:28.483 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 14:28:28.493 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 14:28:28.501 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:28:28.501 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:28:28.504 +08:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 10), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Failures" ("HealthCheckName", "IsUpAndRunning", "LastNotified")
VALUES (@p0, @p1, @p2);
SELECT "Id"
FROM "Failures"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 14:28:28.504 +08:00 [INF] Executed DbCommand (0ms) [Parameters=[@p0='?' (Size = 10), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Failures" ("HealthCheckName", "IsUpAndRunning", "LastNotified")
VALUES (@p0, @p1, @p2);
SELECT "Id"
FROM "Failures"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 14:28:28.507 +08:00 [DBG] Foreign key property 'HealthCheckFailureNotification.Id' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:28:28.509 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:28:28.510 +08:00 [DBG] Committing transaction.
2020-04-27 14:28:28.541 +08:00 [DBG] Committing transaction.
2020-04-27 14:28:28.542 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:28.553 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:28.554 +08:00 [DBG] Disposing transaction.
2020-04-27 14:28:28.556 +08:00 [DBG] An 'HealthCheckFailureNotification' entity tracked by 'HealthChecksDb' changed from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:28.556 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 1 entities written to the database.
2020-04-27 14:28:28.558 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 14:28:28.561 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:28:28.561 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:28:28.562 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:28.565 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:28.567 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:28:28.575 +08:00 [INF] Executed DbCommand (9ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:28:28.576 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:28.579 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:28.581 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:28:28.584 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:28.586 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:28.588 +08:00 [DBG] HealthReport history already exists and is in the same state, updating the values.
2020-04-27 14:28:28.589 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 14:28:28.590 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 14:28:28.591 +08:00 [DBG] Unchanged 'HealthCheckExecution.LastExecuted' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:28:28.591 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:28.591 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Description' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:28:28.591 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:28.592 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Duration' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:28:28.592 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 14:28:28.592 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:28.592 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:28.592 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 14:28:28.595 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 14:28:28.600 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:28:28.601 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:28:28.603 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:28:28.605 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:28:28.605 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:28:28.605 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:28:28.605 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:28:28.605 +08:00 [DBG] Executing DbCommand [Parameters=[@p2='?', @p0='?' (Size = 54), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 14:28:28.605 +08:00 [INF] Executed DbCommand (0ms) [Parameters=[@p2='?', @p0='?' (Size = 54), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 14:28:28.605 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:28:28.605 +08:00 [DBG] Committing transaction.
2020-04-27 14:28:28.634 +08:00 [DBG] Committing transaction.
2020-04-27 14:28:28.634 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:28.647 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:28.648 +08:00 [DBG] Disposing transaction.
2020-04-27 14:28:28.649 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:28.651 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:28.652 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 14:28:28.652 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 14:28:28.653 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 14:28:28.653 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 14:28:34.739 +08:00 [DBG] Starting HttpMessageHandler cleanup cycle with 2 items
2020-04-27 14:28:34.739 +08:00 [DBG] Ending HttpMessageHandler cleanup cycle after 0.004ms - processed: 0 items - remaining: 2 items
2020-04-27 14:28:38.656 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 14:28:38.657 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 14:28:38.657 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:28:38.657 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:28:38.657 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:38.658 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:38.658 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:28:38.663 +08:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:28:38.663 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:38.663 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:28:38.663 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:38.667 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:38.667 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 14:28:38.667 +08:00 [VRB] Request Headers:

2020-04-27 14:28:38.667 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 14:28:38.667 +08:00 [VRB] Request Headers:

2020-04-27 14:28:38.682 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 14:28:38.682 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:28:38.682 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 14:28:38.682 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 14:28:38.682 +08:00 [DBG] Running health checks
2020-04-27 14:28:38.683 +08:00 [DBG] Running health check redis
2020-04-27 14:28:44.744 +08:00 [DBG] Starting HttpMessageHandler cleanup cycle with 2 items
2020-04-27 14:28:44.747 +08:00 [DBG] Connection id "0HLVAEEMM6ODL" received FIN.
2020-04-27 14:28:44.748 +08:00 [DBG] Connection id "0HLVAEEMM6ODL" sending FIN because: "The client closed the connection."
2020-04-27 14:28:44.749 +08:00 [DBG] Ending HttpMessageHandler cleanup cycle after 3.9246ms - processed: 2 items - remaining: 0 items
2020-04-27 14:28:44.748 +08:00 [DBG] Connection id "0HLVAEEMM6ODL" disconnecting.
2020-04-27 14:28:44.749 +08:00 [DBG] Connection id "0HLVAEEMM6ODL" stopped.
2020-04-27 14:28:48.742 +08:00 [ERR] Health check redis completed after 10058.5312ms with status "Unhealthy" and 'null'
2020-04-27 14:28:48.742 +08:00 [DBG] Health check processing completed after 10059.5318ms with combined status "Unhealthy"
2020-04-27 14:28:48.743 +08:00 [DBG] Connection id "0HLVAEEMM6ODS" completed keep alive response.
2020-04-27 14:28:48.743 +08:00 [INF] Request finished in 10061.2826ms 503 application/json
2020-04-27 14:28:48.757 +08:00 [INF] Received HTTP response after 10089.5463ms - "ServiceUnavailable"
2020-04-27 14:28:48.759 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:28:48 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:28:48.761 +08:00 [INF] End processing HTTP request after 10092.1304ms - "ServiceUnavailable"
2020-04-27 14:28:48.761 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:28:48 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:28:48.765 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:28:48.765 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:28:48.765 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:48.767 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:48.769 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:28:48.775 +08:00 [INF] Executed DbCommand (8ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:28:48.777 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:48.779 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:28:48.779 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:48.783 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:48.783 +08:00 [INF] Notification is sent on same window time.
2020-04-27 14:28:48.783 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 14:28:48.788 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:28:48.788 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:28:48.788 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:48.789 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:48.790 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:28:48.797 +08:00 [INF] Executed DbCommand (7ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:28:48.800 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:48.802 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:48.802 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:28:48.802 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:48.804 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:48.804 +08:00 [DBG] HealthReport history already exists and is in the same state, updating the values.
2020-04-27 14:28:48.805 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 14:28:48.806 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 14:28:48.808 +08:00 [DBG] Unchanged 'HealthCheckExecution.LastExecuted' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:28:48.808 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:48.809 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Description' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:28:48.810 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:48.810 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Duration' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:28:48.811 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 14:28:48.811 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:48.811 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:48.812 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 14:28:48.819 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 14:28:48.820 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:28:48.820 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:28:48.820 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:28:48.823 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:28:48.823 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:28:48.826 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:28:48.827 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2020-04-27 14:28:48.827 +08:00 [DBG] Executing DbCommand [Parameters=[@p2='?', @p0='?' (Size = 344), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 14:28:48.828 +08:00 [INF] Executed DbCommand (0ms) [Parameters=[@p2='?', @p0='?' (Size = 344), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 14:28:48.828 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:28:48.829 +08:00 [DBG] Committing transaction.
2020-04-27 14:28:48.858 +08:00 [DBG] Committing transaction.
2020-04-27 14:28:48.858 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:48.871 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:48.871 +08:00 [DBG] Disposing transaction.
2020-04-27 14:28:48.871 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:48.871 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:48.871 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 14:28:48.871 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 14:28:48.871 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 14:28:48.871 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 14:28:58.887 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 14:28:58.890 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 14:28:58.890 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:28:58.891 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:28:58.891 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:58.892 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:58.892 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:28:58.897 +08:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:28:58.897 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:28:58.897 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:28:58.898 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:58.901 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:28:58.901 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 14:28:58.901 +08:00 [VRB] Request Headers:

2020-04-27 14:28:58.901 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 14:28:58.901 +08:00 [VRB] Request Headers:

2020-04-27 14:28:58.914 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 14:28:58.915 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:28:58.916 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 14:28:58.917 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 14:28:58.917 +08:00 [DBG] Running health checks
2020-04-27 14:28:58.918 +08:00 [DBG] Running health check redis
2020-04-27 14:29:07.417 +08:00 [DBG] HttpMessageHandler expired after 120000ms for client 'health-checks'
2020-04-27 14:29:07.417 +08:00 [DBG] HttpMessageHandler expired after 120000ms for client 'health-checks-webhooks'
2020-04-27 14:29:08.978 +08:00 [ERR] Health check redis completed after 10060.0777ms with status "Unhealthy" and 'null'
2020-04-27 14:29:08.978 +08:00 [DBG] Health check processing completed after 10061.2437ms with combined status "Unhealthy"
2020-04-27 14:29:08.979 +08:00 [DBG] Connection id "0HLVAEEMM6ODS" completed keep alive response.
2020-04-27 14:29:08.980 +08:00 [INF] Request finished in 10065.5708ms 503 application/json
2020-04-27 14:29:08.992 +08:00 [INF] Received HTTP response after 10091.441ms - "ServiceUnavailable"
2020-04-27 14:29:08.993 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:29:08 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:29:08.995 +08:00 [INF] End processing HTTP request after 10094.2225ms - "ServiceUnavailable"
2020-04-27 14:29:08.996 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 06:29:08 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 14:29:09.000 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:29:09.000 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:29:09.001 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:09.001 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:09.002 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:29:09.008 +08:00 [INF] Executed DbCommand (6ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 14:29:09.009 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:29:09.011 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:29:09.012 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:09.015 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:09.015 +08:00 [INF] Notification is sent on same window time.
2020-04-27 14:29:09.015 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 14:29:09.020 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:29:09.020 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:29:09.020 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:09.022 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:09.023 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:29:09.029 +08:00 [INF] Executed DbCommand (6ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:29:09.029 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:29:09.029 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:29:09.030 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:29:09.030 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:09.035 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:09.036 +08:00 [DBG] HealthReport history already exists and is in the same state, updating the values.
2020-04-27 14:29:09.038 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 14:29:09.038 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 14:29:09.041 +08:00 [DBG] Unchanged 'HealthCheckExecution.LastExecuted' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:29:09.044 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:29:09.044 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Description' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:29:09.044 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:29:09.044 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Duration' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 14:29:09.044 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 14:29:09.048 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:09.049 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:09.051 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 14:29:09.059 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 14:29:09.065 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:29:09.065 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:29:09.066 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:29:09.069 +08:00 [INF] Executed DbCommand (4ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 14:29:09.069 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:29:09.072 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:29:09.072 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:29:09.072 +08:00 [DBG] Executing DbCommand [Parameters=[@p2='?', @p0='?' (Size = 344), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 14:29:09.072 +08:00 [INF] Executed DbCommand (0ms) [Parameters=[@p2='?', @p0='?' (Size = 344), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 14:29:09.072 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:29:09.072 +08:00 [DBG] Committing transaction.
2020-04-27 14:29:09.107 +08:00 [DBG] Committing transaction.
2020-04-27 14:29:09.107 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:09.119 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:09.121 +08:00 [DBG] Disposing transaction.
2020-04-27 14:29:09.121 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:29:09.121 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:29:09.121 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 14:29:09.121 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 14:29:09.121 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 14:29:09.122 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 14:29:12.062 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/ui  
2020-04-27 14:29:12.063 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:29:12.063 +08:00 [DBG] The request path /ui does not match a supported file type
2020-04-27 14:29:12.065 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 14:29:12.072 +08:00 [DBG] Connection id "0HLVAEEMM6ODM" completed keep alive response.
2020-04-27 14:29:12.073 +08:00 [INF] Request finished in 15.2078ms 200 text/html
2020-04-27 14:29:12.103 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/ui/resources/healthchecksui-min.css  
2020-04-27 14:29:12.104 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:29:12.104 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/ui/resources/vendors-dll.js  
2020-04-27 14:29:12.104 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:29:12.104 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/ui/resources/healthchecks-bundle.js  
2020-04-27 14:29:12.104 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:29:12.104 +08:00 [DBG] The request path /ui/resources/vendors-dll.js does not match an existing file
2020-04-27 14:29:12.104 +08:00 [DBG] The request path /ui/resources/healthchecks-bundle.js does not match an existing file
2020-04-27 14:29:12.104 +08:00 [DBG] The request path /ui/resources/healthchecksui-min.css does not match an existing file
2020-04-27 14:29:12.105 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 14:29:12.105 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 14:29:12.105 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 14:29:12.109 +08:00 [DBG] Connection id "0HLVAEEMM6ODM" completed keep alive response.
2020-04-27 14:29:12.109 +08:00 [DBG] Connection id "0HLVAEEMM6ODR" completed keep alive response.
2020-04-27 14:29:12.109 +08:00 [INF] Request finished in 5.1426ms 200 text/javascript
2020-04-27 14:29:12.109 +08:00 [INF] Request finished in 6.2926ms 200 text/css
2020-04-27 14:29:12.146 +08:00 [DBG] Connection id "0HLVAEEMM6ODQ" completed keep alive response.
2020-04-27 14:29:12.146 +08:00 [INF] Request finished in 41.5375ms 200 text/javascript
2020-04-27 14:29:12.199 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/healthchecks-api application/json 
2020-04-27 14:29:12.199 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:29:12.199 +08:00 [DBG] The request path /healthchecks-api does not match a supported file type
2020-04-27 14:29:12.200 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 14:29:12.211 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 14:29:12.212 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:29:12.212 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:29:12.212 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:12.213 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:12.214 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:29:12.220 +08:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:29:12.221 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:29:12.221 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:29:12.221 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:12.222 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:12.268 +08:00 [DBG] queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<HealthCheckExecution>(
    asyncEnumerable: new QueryingEnumerable<HealthCheckExecution>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache, 
        null, 
        null, 
        Func<QueryContext, DbDataReader, ResultContext, int[], ResultCoordinator, HealthCheckExecution>, 
        HealthChecks.UI.Core.Data.HealthChecksDb, 
        DiagnosticsLogger<Query>
    ), 
    cancellationToken: queryContext.CancellationToken)
2020-04-27 14:29:12.269 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:29:12.269 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:29:12.269 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:12.271 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:12.271 +08:00 [DBG] Executing DbCommand [Parameters=[@__item_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__item_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:29:12.276 +08:00 [INF] Executed DbCommand (5ms) [Parameters=[@__item_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__item_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:29:12.282 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:29:12.282 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:12.285 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:12.339 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 14:29:12.341 +08:00 [DBG] Connection id "0HLVAEEMM6ODQ" completed keep alive response.
2020-04-27 14:29:12.341 +08:00 [INF] Request finished in 142.1859ms 200 application/json
2020-04-27 14:29:12.386 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/favicon.ico  
2020-04-27 14:29:12.386 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:29:12.386 +08:00 [DBG] The request path /favicon.ico does not match an existing file
2020-04-27 14:29:12.387 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 14:29:12.387 +08:00 [DBG] No candidates found for the request path '/favicon.ico'
2020-04-27 14:29:12.388 +08:00 [DBG] Request did not match any endpoints
2020-04-27 14:29:12.388 +08:00 [DBG] Connection id "0HLVAEEMM6ODQ" completed keep alive response.
2020-04-27 14:29:12.388 +08:00 [INF] Request finished in 2.5544ms 404 
2020-04-27 14:29:17.417 +08:00 [DBG] Starting HttpMessageHandler cleanup cycle with 2 items
2020-04-27 14:29:17.417 +08:00 [DBG] Ending HttpMessageHandler cleanup cycle after 0.0014ms - processed: 0 items - remaining: 2 items
2020-04-27 14:29:19.135 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 14:29:19.138 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 14:29:19.138 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:29:19.138 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:29:19.138 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:19.139 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:19.140 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:29:19.143 +08:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:29:19.144 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:29:19.145 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:29:19.145 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:19.147 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:19.147 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 14:29:19.147 +08:00 [VRB] Request Headers:

2020-04-27 14:29:19.147 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 14:29:19.147 +08:00 [VRB] Request Headers:

2020-04-27 14:29:19.169 +08:00 [DBG] Connection id "0HLVAEEMM6ODT" accepted.
2020-04-27 14:29:19.169 +08:00 [DBG] Connection id "0HLVAEEMM6ODT" started.
2020-04-27 14:29:19.170 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 14:29:19.170 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:29:19.170 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 14:29:19.171 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 14:29:19.171 +08:00 [DBG] Running health checks
2020-04-27 14:29:19.172 +08:00 [DBG] Running health check redis
2020-04-27 14:29:22.710 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/healthchecks-api application/json 
2020-04-27 14:29:22.710 +08:00 [VRB] All hosts are allowed.
2020-04-27 14:29:22.711 +08:00 [DBG] The request path /healthchecks-api does not match a supported file type
2020-04-27 14:29:22.711 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 14:29:22.711 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 14:29:22.711 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:29:22.711 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:29:22.711 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:22.712 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:22.713 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:29:22.716 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 14:29:22.716 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 14:29:22.716 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:29:22.716 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:22.718 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:22.718 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 14:29:22.718 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 14:29:22.718 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:22.719 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:22.719 +08:00 [DBG] Executing DbCommand [Parameters=[@__item_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__item_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:29:22.722 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@__item_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__item_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 14:29:22.722 +08:00 [DBG] A data reader was disposed.
2020-04-27 14:29:22.722 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:22.724 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 14:29:22.725 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 14:29:22.725 +08:00 [DBG] Connection id "0HLVAEEMM6ODQ" completed keep alive response.
2020-04-27 14:29:22.725 +08:00 [INF] Request finished in 15.2572ms 200 application/json
2020-04-27 15:19:01.289 +08:00 [DBG] Hosting starting
2020-04-27 15:19:01.504 +08:00 [DBG] Failed to locate the development https certificate at 'null'.
2020-04-27 15:19:01.514 +08:00 [INF] Now listening on: http://localhost:5001
2020-04-27 15:19:01.516 +08:00 [DBG] Loaded hosting startup assembly Leon.XXX.Api
2020-04-27 15:19:01.520 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 15:19:01.525 +08:00 [DBG] Connection id "0HLVAFD19D1BK" received FIN.
2020-04-27 15:19:01.535 +08:00 [DBG] Connection id "0HLVAFD19D1BK" accepted.
2020-04-27 15:19:01.537 +08:00 [DBG] Connection id "0HLVAFD19D1BK" started.
2020-04-27 15:19:01.553 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 15:19:01.553 +08:00 [DBG] Connection id "0HLVAFD19D1BK" sending FIN because: "The client closed the connection."
2020-04-27 15:19:01.557 +08:00 [DBG] Connection id "0HLVAFD19D1BK" disconnecting.
2020-04-27 15:19:01.562 +08:00 [DBG] Connection id "0HLVAFD19D1BK" stopped.
2020-04-27 15:19:01.655 +08:00 [DBG] queryContext => new QueryingEnumerable<HealthCheckConfiguration>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache, 
    null, 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, int[], ResultCoordinator, HealthCheckConfiguration>, 
    HealthChecks.UI.Core.Data.HealthChecksDb, 
    DiagnosticsLogger<Query>
)
2020-04-27 15:19:01.674 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:19:01.680 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:19:01.681 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:01.682 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:01.688 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:19:01.696 +08:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:19:01.701 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:19:01.706 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:19:01.708 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:01.711 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:01.719 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 15:19:01.725 +08:00 [VRB] Request Headers:

2020-04-27 15:19:01.727 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 15:19:01.729 +08:00 [VRB] Request Headers:

2020-04-27 15:19:01.765 +08:00 [INF] Application started. Press Ctrl+C to shut down.
2020-04-27 15:19:01.767 +08:00 [INF] Hosting environment: Development
2020-04-27 15:19:01.767 +08:00 [INF] Content root path: F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api
2020-04-27 15:19:01.767 +08:00 [DBG] Hosting started
2020-04-27 15:19:01.770 +08:00 [DBG] Connection id "0HLVAFD19D1BL" accepted.
2020-04-27 15:19:01.770 +08:00 [DBG] Connection id "0HLVAFD19D1BL" started.
2020-04-27 15:19:01.799 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 15:19:01.802 +08:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2020-04-27 15:19:01.804 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:19:01.807 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 15:19:01.866 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 15:19:01.873 +08:00 [DBG] Running health checks
2020-04-27 15:19:01.879 +08:00 [DBG] Running health check redis
2020-04-27 15:19:04.971 +08:00 [DBG] Connection id "0HLVAFD19D1BM" accepted.
2020-04-27 15:19:04.972 +08:00 [DBG] Connection id "0HLVAFD19D1BM" started.
2020-04-27 15:19:04.979 +08:00 [DBG] Connection id "0HLVAFD19D1BN" accepted.
2020-04-27 15:19:04.981 +08:00 [DBG] Connection id "0HLVAFD19D1BN" started.
2020-04-27 15:19:04.986 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/swagger  
2020-04-27 15:19:04.986 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:19:04.991 +08:00 [DBG] The request path /swagger does not match a supported file type
2020-04-27 15:19:05.002 +08:00 [DBG] Connection id "0HLVAFD19D1BM" completed keep alive response.
2020-04-27 15:19:05.009 +08:00 [INF] Request finished in 21.8492ms 301 
2020-04-27 15:19:05.019 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/swagger/index.html  
2020-04-27 15:19:05.019 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:19:05.027 +08:00 [DBG] The request path /swagger/index.html does not match an existing file
2020-04-27 15:19:05.043 +08:00 [DBG] Connection id "0HLVAFD19D1BM" completed keep alive response.
2020-04-27 15:19:05.044 +08:00 [INF] Request finished in 25.0341ms 200 text/html;charset=utf-8
2020-04-27 15:19:05.284 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/docs/v1/docs.json  
2020-04-27 15:19:05.284 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:19:05.285 +08:00 [DBG] The request path /docs/v1/docs.json does not match an existing file
2020-04-27 15:19:05.405 +08:00 [DBG] Connection id "0HLVAFD19D1BM" completed keep alive response.
2020-04-27 15:19:05.405 +08:00 [INF] Request finished in 121.493ms 200 application/json;charset=utf-8
2020-04-27 15:19:17.102 +08:00 [ERR] Health check redis completed after 15219.5282ms with status "Unhealthy" and 'null'
2020-04-27 15:19:17.112 +08:00 [DBG] Health check processing completed after 15236.2209ms with combined status "Unhealthy"
2020-04-27 15:19:17.126 +08:00 [DBG] Connection id "0HLVAFD19D1BL" completed keep alive response.
2020-04-27 15:19:17.126 +08:00 [INF] Request finished in 15327.8374ms 503 application/json
2020-04-27 15:19:17.152 +08:00 [INF] Received HTTP response after 15422.4948ms - "ServiceUnavailable"
2020-04-27 15:19:17.158 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:19:16 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:19:17.160 +08:00 [INF] End processing HTTP request after 15443.8548ms - "ServiceUnavailable"
2020-04-27 15:19:17.161 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:19:16 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:19:17.334 +08:00 [DBG] queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<HealthCheckFailureNotification>(
    asyncEnumerable: new QueryingEnumerable<HealthCheckFailureNotification>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache, 
        null, 
        null, 
        Func<QueryContext, DbDataReader, ResultContext, int[], ResultCoordinator, HealthCheckFailureNotification>, 
        HealthChecks.UI.Core.Data.HealthChecksDb, 
        DiagnosticsLogger<Query>
    ), 
    cancellationToken: queryContext.CancellationToken)
2020-04-27 15:19:17.340 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:19:17.340 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:19:17.341 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:17.344 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:17.347 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:19:17.350 +08:00 [INF] Executed DbCommand (5ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:19:17.352 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:19:17.353 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:17.357 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:17.365 +08:00 [DBG] 'HealthChecksDb' generated a temporary value for the 'Id' property of new 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:19:17.374 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:19:17.374 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 15:19:17.374 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 15:19:17.385 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 15:19:17.385 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:17.387 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:17.389 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 15:19:17.392 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 15:19:17.395 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:19:17.395 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:19:17.399 +08:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 10), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Failures" ("HealthCheckName", "IsUpAndRunning", "LastNotified")
VALUES (@p0, @p1, @p2);
SELECT "Id"
FROM "Failures"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:19:17.400 +08:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 10), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Failures" ("HealthCheckName", "IsUpAndRunning", "LastNotified")
VALUES (@p0, @p1, @p2);
SELECT "Id"
FROM "Failures"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:19:17.403 +08:00 [DBG] Foreign key property 'HealthCheckFailureNotification.Id' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:19:17.404 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:19:17.406 +08:00 [DBG] Committing transaction.
2020-04-27 15:19:17.431 +08:00 [DBG] Committing transaction.
2020-04-27 15:19:17.432 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:17.444 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:17.444 +08:00 [DBG] Disposing transaction.
2020-04-27 15:19:17.453 +08:00 [DBG] An 'HealthCheckFailureNotification' entity tracked by 'HealthChecksDb' changed from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:19:17.453 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 1 entities written to the database.
2020-04-27 15:19:17.460 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 15:19:17.503 +08:00 [DBG] queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<HealthCheckExecution>(
    asyncEnumerable: new QueryingEnumerable<HealthCheckExecution>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache, 
        null, 
        null, 
        Func<QueryContext, DbDataReader, ResultContext, int[], ResultCoordinator, HealthCheckExecution>, 
        HealthChecks.UI.Core.Data.HealthChecksDb, 
        DiagnosticsLogger<Query>
    ), 
    cancellationToken: queryContext.CancellationToken)
2020-04-27 15:19:17.505 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:19:17.505 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:19:17.505 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:17.507 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:17.507 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:19:17.510 +08:00 [INF] Executed DbCommand (2ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:19:17.512 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:19:17.512 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:17.515 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:17.515 +08:00 [DBG] Creating a new HealthReport history.
2020-04-27 15:19:17.530 +08:00 [DBG] 'HealthChecksDb' generated a temporary value for the 'Id' property of new 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:19:17.543 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:19:17.549 +08:00 [DBG] 'HealthChecksDb' generated a temporary value for the 'Id' property of new 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:19:17.560 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:19:17.560 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 15:19:17.561 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 15:19:17.572 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 15:19:17.573 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:17.574 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:17.575 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 15:19:17.577 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 15:19:17.583 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:19:17.583 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:19:17.586 +08:00 [DBG] Executing DbCommand [Parameters=[@p0='?', @p1='?', @p2='?' (Size = 10), @p3='?', @p4='?', @p5='?' (Size = 7)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Executions" ("DiscoveryService", "LastExecuted", "Name", "OnStateFrom", "Status", "Uri")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
SELECT "Id"
FROM "Executions"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:19:17.587 +08:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?', @p1='?', @p2='?' (Size = 10), @p3='?', @p4='?', @p5='?' (Size = 7)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Executions" ("DiscoveryService", "LastExecuted", "Name", "OnStateFrom", "Status", "Uri")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
SELECT "Id"
FROM "Executions"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:19:17.590 +08:00 [DBG] Foreign key property 'HealthCheckExecution.Id' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:19:17.595 +08:00 [DBG] Foreign key property 'HealthCheckExecutionEntry.HealthCheckExecutionId' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:19:17.598 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:19:17.599 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:19:17.599 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:19:17.601 +08:00 [DBG] Executing DbCommand [Parameters=[@p6='?' (Size = 343), @p7='?', @p8='?', @p9='?' (Size = 5), @p10='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "HealthCheckExecutionEntries" ("Description", "Duration", "HealthCheckExecutionId", "Name", "Status")
VALUES (@p6, @p7, @p8, @p9, @p10);
SELECT "Id"
FROM "HealthCheckExecutionEntries"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:19:17.603 +08:00 [INF] Executed DbCommand (4ms) [Parameters=[@p6='?' (Size = 343), @p7='?', @p8='?', @p9='?' (Size = 5), @p10='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "HealthCheckExecutionEntries" ("Description", "Duration", "HealthCheckExecutionId", "Name", "Status")
VALUES (@p6, @p7, @p8, @p9, @p10);
SELECT "Id"
FROM "HealthCheckExecutionEntries"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:19:17.606 +08:00 [DBG] Foreign key property 'HealthCheckExecutionEntry.Id' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:19:17.607 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:19:17.608 +08:00 [DBG] Committing transaction.
2020-04-27 15:19:17.643 +08:00 [DBG] Committing transaction.
2020-04-27 15:19:17.643 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:17.655 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:17.656 +08:00 [DBG] Disposing transaction.
2020-04-27 15:19:17.660 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:19:17.662 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:19:17.662 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 15:19:17.663 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 15:19:17.666 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 15:19:17.667 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 15:19:27.678 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 15:19:27.705 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 15:19:27.708 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:19:27.709 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2020-04-27 15:19:27.709 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:27.712 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:27.713 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:19:27.717 +08:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:19:27.719 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:19:27.720 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:19:27.721 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:27.725 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:19:27.725 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 15:19:27.727 +08:00 [VRB] Request Headers:

2020-04-27 15:19:27.728 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 15:19:27.729 +08:00 [VRB] Request Headers:

2020-04-27 15:19:27.745 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 15:19:27.746 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:19:27.748 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 15:19:27.750 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 15:19:27.752 +08:00 [DBG] Running health checks
2020-04-27 15:19:27.754 +08:00 [DBG] Running health check redis
2020-04-27 15:19:33.347 +08:00 [DBG] Connection id "0HLVAFD19D1BM" received FIN.
2020-04-27 15:19:33.352 +08:00 [DBG] Connection id "0HLVAFD19D1BN" received FIN.
2020-04-27 15:19:33.364 +08:00 [DBG] Connection id "0HLVAFD19D1BN" sending FIN because: "The client closed the connection."
2020-04-27 15:19:33.364 +08:00 [DBG] Connection id "0HLVAFD19D1BM" sending FIN because: "The client closed the connection."
2020-04-27 15:19:33.364 +08:00 [DBG] Connection id "0HLVAFD19D1BN" disconnecting.
2020-04-27 15:19:33.365 +08:00 [DBG] Connection id "0HLVAFD19D1BM" disconnecting.
2020-04-27 15:19:33.376 +08:00 [DBG] Connection id "0HLVAFD19D1BM" stopped.
2020-04-27 15:19:33.376 +08:00 [DBG] Connection id "0HLVAFD19D1BN" stopped.
2020-04-27 15:21:47.608 +08:00 [DBG] Hosting starting
2020-04-27 15:21:47.831 +08:00 [DBG] Failed to locate the development https certificate at 'null'.
2020-04-27 15:21:47.841 +08:00 [INF] Now listening on: http://localhost:5001
2020-04-27 15:21:47.842 +08:00 [DBG] Loaded hosting startup assembly Leon.XXX.Api
2020-04-27 15:21:47.845 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 15:21:47.871 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 15:21:47.960 +08:00 [DBG] queryContext => new QueryingEnumerable<HealthCheckConfiguration>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache, 
    null, 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, int[], ResultCoordinator, HealthCheckConfiguration>, 
    HealthChecks.UI.Core.Data.HealthChecksDb, 
    DiagnosticsLogger<Query>
)
2020-04-27 15:21:47.977 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:21:47.983 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:21:47.988 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:21:47.990 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:21:47.996 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:21:48.002 +08:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:21:48.007 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:21:48.011 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:21:48.011 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:21:48.014 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:21:48.091 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 15:21:48.092 +08:00 [DBG] Connection id "0HLVAFEITT3TD" received FIN.
2020-04-27 15:21:48.098 +08:00 [VRB] Request Headers:

2020-04-27 15:21:48.100 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 15:21:48.101 +08:00 [VRB] Request Headers:

2020-04-27 15:21:48.120 +08:00 [DBG] Connection id "0HLVAFEITT3TD" accepted.
2020-04-27 15:21:48.122 +08:00 [DBG] Connection id "0HLVAFEITT3TD" started.
2020-04-27 15:21:48.142 +08:00 [INF] Application started. Press Ctrl+C to shut down.
2020-04-27 15:21:48.142 +08:00 [INF] Hosting environment: Development
2020-04-27 15:21:48.143 +08:00 [INF] Content root path: F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api
2020-04-27 15:21:48.144 +08:00 [DBG] Hosting started
2020-04-27 15:21:48.146 +08:00 [DBG] Connection id "0HLVAFEITT3TE" accepted.
2020-04-27 15:21:48.147 +08:00 [DBG] Connection id "0HLVAFEITT3TE" started.
2020-04-27 15:21:48.152 +08:00 [DBG] Connection id "0HLVAFEITT3TD" sending FIN because: "The client closed the connection."
2020-04-27 15:21:48.153 +08:00 [DBG] Connection id "0HLVAFEITT3TD" disconnecting.
2020-04-27 15:21:48.156 +08:00 [DBG] Connection id "0HLVAFEITT3TD" stopped.
2020-04-27 15:21:48.169 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 15:21:48.172 +08:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2020-04-27 15:21:48.173 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:21:48.176 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 15:21:48.224 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 15:21:48.231 +08:00 [DBG] Running health checks
2020-04-27 15:21:48.235 +08:00 [DBG] Running health check redis
2020-04-27 15:21:51.294 +08:00 [DBG] Connection id "0HLVAFEITT3TF" accepted.
2020-04-27 15:21:51.295 +08:00 [DBG] Connection id "0HLVAFEITT3TF" started.
2020-04-27 15:21:51.297 +08:00 [DBG] Connection id "0HLVAFEITT3TG" accepted.
2020-04-27 15:21:51.299 +08:00 [DBG] Connection id "0HLVAFEITT3TG" started.
2020-04-27 15:21:51.308 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/swagger/index.html  
2020-04-27 15:21:51.308 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:21:51.321 +08:00 [DBG] The request path /swagger/index.html does not match an existing file
2020-04-27 15:21:51.345 +08:00 [DBG] Connection id "0HLVAFEITT3TF" completed keep alive response.
2020-04-27 15:21:51.351 +08:00 [INF] Request finished in 42.5564ms 200 text/html;charset=utf-8
2020-04-27 15:21:51.532 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/docs/v1/docs.json  
2020-04-27 15:21:51.532 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:21:51.538 +08:00 [DBG] The request path /docs/v1/docs.json does not match an existing file
2020-04-27 15:21:51.653 +08:00 [DBG] Connection id "0HLVAFEITT3TF" completed keep alive response.
2020-04-27 15:21:51.656 +08:00 [INF] Request finished in 123.4364ms 200 application/json;charset=utf-8
2020-04-27 15:22:01.613 +08:00 [DBG] Connection id "0HLVAFEITT3TG" received FIN.
2020-04-27 15:22:01.615 +08:00 [DBG] Connection id "0HLVAFEITT3TG" sending FIN because: "The client closed the connection."
2020-04-27 15:22:01.617 +08:00 [DBG] Connection id "0HLVAFEITT3TG" disconnecting.
2020-04-27 15:22:01.619 +08:00 [DBG] Connection id "0HLVAFEITT3TG" stopped.
2020-04-27 15:22:03.474 +08:00 [ERR] Health check redis completed after 15235.2108ms with status "Unhealthy" and 'null'
2020-04-27 15:22:03.484 +08:00 [DBG] Health check processing completed after 15250.4118ms with combined status "Unhealthy"
2020-04-27 15:22:03.502 +08:00 [DBG] Connection id "0HLVAFEITT3TE" completed keep alive response.
2020-04-27 15:22:03.504 +08:00 [INF] Request finished in 15334.8012ms 503 application/json
2020-04-27 15:22:03.528 +08:00 [INF] Received HTTP response after 15425.5839ms - "ServiceUnavailable"
2020-04-27 15:22:03.533 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:22:02 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:22:03.536 +08:00 [INF] End processing HTTP request after 15447.0481ms - "ServiceUnavailable"
2020-04-27 15:22:03.537 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:22:02 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:22:03.710 +08:00 [DBG] queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<HealthCheckFailureNotification>(
    asyncEnumerable: new QueryingEnumerable<HealthCheckFailureNotification>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache, 
        null, 
        null, 
        Func<QueryContext, DbDataReader, ResultContext, int[], ResultCoordinator, HealthCheckFailureNotification>, 
        HealthChecks.UI.Core.Data.HealthChecksDb, 
        DiagnosticsLogger<Query>
    ), 
    cancellationToken: queryContext.CancellationToken)
2020-04-27 15:22:03.717 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:22:03.718 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:22:03.720 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:03.722 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:03.725 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:22:03.728 +08:00 [INF] Executed DbCommand (5ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:22:03.729 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:22:03.731 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:03.732 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:03.742 +08:00 [DBG] 'HealthChecksDb' generated a temporary value for the 'Id' property of new 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:03.753 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:03.753 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 15:22:03.755 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 15:22:03.765 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 15:22:03.767 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:03.770 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:03.773 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 15:22:03.776 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 15:22:03.779 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:22:03.779 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:22:03.785 +08:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 10), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Failures" ("HealthCheckName", "IsUpAndRunning", "LastNotified")
VALUES (@p0, @p1, @p2);
SELECT "Id"
FROM "Failures"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:22:03.789 +08:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 10), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Failures" ("HealthCheckName", "IsUpAndRunning", "LastNotified")
VALUES (@p0, @p1, @p2);
SELECT "Id"
FROM "Failures"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:22:03.793 +08:00 [DBG] Foreign key property 'HealthCheckFailureNotification.Id' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:22:03.794 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:22:03.796 +08:00 [DBG] Committing transaction.
2020-04-27 15:22:03.831 +08:00 [DBG] Committing transaction.
2020-04-27 15:22:03.831 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:03.843 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:03.843 +08:00 [DBG] Disposing transaction.
2020-04-27 15:22:03.851 +08:00 [DBG] An 'HealthCheckFailureNotification' entity tracked by 'HealthChecksDb' changed from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:03.851 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 1 entities written to the database.
2020-04-27 15:22:03.858 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 15:22:03.900 +08:00 [DBG] queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<HealthCheckExecution>(
    asyncEnumerable: new QueryingEnumerable<HealthCheckExecution>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache, 
        null, 
        null, 
        Func<QueryContext, DbDataReader, ResultContext, int[], ResultCoordinator, HealthCheckExecution>, 
        HealthChecks.UI.Core.Data.HealthChecksDb, 
        DiagnosticsLogger<Query>
    ), 
    cancellationToken: queryContext.CancellationToken)
2020-04-27 15:22:03.903 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:22:03.904 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:22:03.904 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:03.905 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:03.906 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:22:03.908 +08:00 [INF] Executed DbCommand (2ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:22:03.908 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:22:03.908 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:03.913 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:03.913 +08:00 [DBG] Creating a new HealthReport history.
2020-04-27 15:22:03.926 +08:00 [DBG] 'HealthChecksDb' generated a temporary value for the 'Id' property of new 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:03.939 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:03.945 +08:00 [DBG] 'HealthChecksDb' generated a temporary value for the 'Id' property of new 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:03.957 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:03.957 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 15:22:03.957 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 15:22:03.970 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 15:22:03.971 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:03.972 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:03.974 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 15:22:03.976 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 15:22:03.980 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:22:03.980 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:22:03.984 +08:00 [DBG] Executing DbCommand [Parameters=[@p0='?', @p1='?', @p2='?' (Size = 10), @p3='?', @p4='?', @p5='?' (Size = 7)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Executions" ("DiscoveryService", "LastExecuted", "Name", "OnStateFrom", "Status", "Uri")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
SELECT "Id"
FROM "Executions"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:22:03.986 +08:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?', @p1='?', @p2='?' (Size = 10), @p3='?', @p4='?', @p5='?' (Size = 7)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Executions" ("DiscoveryService", "LastExecuted", "Name", "OnStateFrom", "Status", "Uri")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
SELECT "Id"
FROM "Executions"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:22:03.989 +08:00 [DBG] Foreign key property 'HealthCheckExecution.Id' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:22:03.995 +08:00 [DBG] Foreign key property 'HealthCheckExecutionEntry.HealthCheckExecutionId' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:22:03.997 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:22:03.999 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:22:03.999 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:22:04.001 +08:00 [DBG] Executing DbCommand [Parameters=[@p6='?' (Size = 342), @p7='?', @p8='?', @p9='?' (Size = 5), @p10='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "HealthCheckExecutionEntries" ("Description", "Duration", "HealthCheckExecutionId", "Name", "Status")
VALUES (@p6, @p7, @p8, @p9, @p10);
SELECT "Id"
FROM "HealthCheckExecutionEntries"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:22:04.002 +08:00 [INF] Executed DbCommand (2ms) [Parameters=[@p6='?' (Size = 342), @p7='?', @p8='?', @p9='?' (Size = 5), @p10='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "HealthCheckExecutionEntries" ("Description", "Duration", "HealthCheckExecutionId", "Name", "Status")
VALUES (@p6, @p7, @p8, @p9, @p10);
SELECT "Id"
FROM "HealthCheckExecutionEntries"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:22:04.005 +08:00 [DBG] Foreign key property 'HealthCheckExecutionEntry.Id' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:22:04.006 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:22:04.007 +08:00 [DBG] Committing transaction.
2020-04-27 15:22:04.043 +08:00 [DBG] Committing transaction.
2020-04-27 15:22:04.043 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:04.055 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:04.055 +08:00 [DBG] Disposing transaction.
2020-04-27 15:22:04.059 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:04.061 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:04.061 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 15:22:04.062 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 15:22:04.065 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 15:22:04.066 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 15:22:14.073 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 15:22:14.172 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 15:22:14.174 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:22:14.174 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:22:14.174 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:14.174 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:14.176 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:22:14.180 +08:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:22:14.180 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:14.182 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:22:14.182 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:14.184 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:14.184 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 15:22:14.185 +08:00 [VRB] Request Headers:

2020-04-27 15:22:14.185 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 15:22:14.185 +08:00 [VRB] Request Headers:

2020-04-27 15:22:14.207 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 15:22:14.207 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:22:14.209 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 15:22:14.211 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 15:22:14.212 +08:00 [DBG] Running health checks
2020-04-27 15:22:14.213 +08:00 [DBG] Running health check redis
2020-04-27 15:22:29.343 +08:00 [ERR] Health check redis completed after 15129.9279ms with status "Unhealthy" and 'null'
2020-04-27 15:22:29.344 +08:00 [DBG] Health check processing completed after 15131.7743ms with combined status "Unhealthy"
2020-04-27 15:22:29.346 +08:00 [DBG] Connection id "0HLVAFEITT3TE" completed keep alive response.
2020-04-27 15:22:29.347 +08:00 [INF] Request finished in 15140.227ms 503 application/json
2020-04-27 15:22:29.365 +08:00 [INF] Received HTTP response after 15179.4445ms - "ServiceUnavailable"
2020-04-27 15:22:29.367 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:22:28 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:22:29.367 +08:00 [INF] End processing HTTP request after 15183.5199ms - "ServiceUnavailable"
2020-04-27 15:22:29.368 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:22:28 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:22:29.377 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:22:29.379 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:22:29.380 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:29.382 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:29.383 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:22:29.387 +08:00 [INF] Executed DbCommand (5ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:22:29.393 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:29.395 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:22:29.397 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:29.399 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:29.399 +08:00 [INF] Notification is sent on same window time.
2020-04-27 15:22:29.399 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 15:22:29.408 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:22:29.408 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:22:29.408 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:29.409 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:29.410 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:22:29.415 +08:00 [INF] Executed DbCommand (6ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:22:29.419 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:29.432 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:29.435 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:22:29.435 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:29.440 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:29.441 +08:00 [DBG] HealthReport history already exists and is in the same state, updating the values.
2020-04-27 15:22:29.444 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 15:22:29.444 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 15:22:29.448 +08:00 [DBG] Unchanged 'HealthCheckExecution.LastExecuted' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:22:29.450 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:29.453 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Description' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:22:29.454 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:29.454 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Duration' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:22:29.457 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 15:22:29.459 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:29.460 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:29.461 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 15:22:29.464 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 15:22:29.470 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:22:29.470 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:22:29.472 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:22:29.474 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:22:29.476 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:22:29.478 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:22:29.478 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:22:29.479 +08:00 [DBG] Executing DbCommand [Parameters=[@p2='?', @p0='?' (Size = 54), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 15:22:29.482 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@p2='?', @p0='?' (Size = 54), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 15:22:29.482 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:22:29.484 +08:00 [DBG] Committing transaction.
2020-04-27 15:22:29.515 +08:00 [DBG] Committing transaction.
2020-04-27 15:22:29.515 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:29.527 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:29.527 +08:00 [DBG] Disposing transaction.
2020-04-27 15:22:29.527 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:29.528 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:29.531 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 15:22:29.532 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 15:22:29.534 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 15:22:29.534 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 15:22:39.544 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 15:22:39.547 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 15:22:39.548 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:22:39.549 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:22:39.549 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:39.550 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:39.551 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:22:39.556 +08:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:22:39.559 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:39.559 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:22:39.560 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:39.565 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:39.566 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 15:22:39.566 +08:00 [VRB] Request Headers:

2020-04-27 15:22:39.566 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 15:22:39.566 +08:00 [VRB] Request Headers:

2020-04-27 15:22:39.584 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 15:22:39.586 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:22:39.588 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 15:22:39.590 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 15:22:39.590 +08:00 [DBG] Running health checks
2020-04-27 15:22:39.595 +08:00 [DBG] Running health check redis
2020-04-27 15:22:54.720 +08:00 [ERR] Health check redis completed after 15124.8308ms with status "Unhealthy" and 'null'
2020-04-27 15:22:54.720 +08:00 [DBG] Health check processing completed after 15129.5095ms with combined status "Unhealthy"
2020-04-27 15:22:54.721 +08:00 [DBG] Connection id "0HLVAFEITT3TE" completed keep alive response.
2020-04-27 15:22:54.721 +08:00 [INF] Request finished in 15137.1743ms 503 application/json
2020-04-27 15:22:54.733 +08:00 [INF] Received HTTP response after 15166.2488ms - "ServiceUnavailable"
2020-04-27 15:22:54.735 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:22:53 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:22:54.735 +08:00 [INF] End processing HTTP request after 15169.5182ms - "ServiceUnavailable"
2020-04-27 15:22:54.735 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:22:53 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:22:54.740 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:22:54.740 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:22:54.742 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:54.743 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:54.744 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:22:54.747 +08:00 [INF] Executed DbCommand (4ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:22:54.749 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:54.751 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:22:54.753 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:54.754 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:54.754 +08:00 [INF] Notification is sent on same window time.
2020-04-27 15:22:54.754 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 15:22:54.762 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:22:54.762 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:22:54.762 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:54.763 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:54.763 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:22:54.774 +08:00 [INF] Executed DbCommand (10ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:22:54.775 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:54.779 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:54.781 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:22:54.781 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:54.783 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:54.783 +08:00 [DBG] HealthReport history already exists and is in the same state, updating the values.
2020-04-27 15:22:54.783 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 15:22:54.783 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 15:22:54.784 +08:00 [DBG] Unchanged 'HealthCheckExecution.LastExecuted' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:22:54.791 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:54.791 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Duration' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:22:54.791 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:54.793 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 15:22:54.795 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:54.796 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:54.796 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 15:22:54.798 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 15:22:54.799 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:22:54.799 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:22:54.799 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:22:54.799 +08:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:22:54.799 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:22:54.799 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:22:54.799 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:22:54.799 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Duration" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:22:54.799 +08:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Duration" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:22:54.799 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:22:54.800 +08:00 [DBG] Committing transaction.
2020-04-27 15:22:54.843 +08:00 [DBG] Committing transaction.
2020-04-27 15:22:54.843 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:54.856 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:22:54.857 +08:00 [DBG] Disposing transaction.
2020-04-27 15:22:54.859 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:54.859 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:22:54.859 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 15:22:54.859 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 15:22:54.859 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 15:22:54.860 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 15:23:04.870 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 15:23:04.874 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 15:23:04.875 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:23:04.876 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2020-04-27 15:23:04.876 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:04.878 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:04.880 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:23:04.883 +08:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:23:04.884 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:23:04.885 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:23:04.887 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:04.888 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:04.889 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 15:23:04.889 +08:00 [VRB] Request Headers:

2020-04-27 15:23:04.891 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 15:23:04.893 +08:00 [VRB] Request Headers:

2020-04-27 15:23:04.907 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 15:23:04.907 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:23:04.909 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 15:23:04.912 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 15:23:04.913 +08:00 [DBG] Running health checks
2020-04-27 15:23:04.913 +08:00 [DBG] Running health check redis
2020-04-27 15:23:14.978 +08:00 [ERR] Health check redis completed after 10064.9349ms with status "Unhealthy" and 'null'
2020-04-27 15:23:14.979 +08:00 [DBG] Health check processing completed after 10065.4161ms with combined status "Unhealthy"
2020-04-27 15:23:14.982 +08:00 [DBG] Connection id "0HLVAFEITT3TE" completed keep alive response.
2020-04-27 15:23:14.985 +08:00 [INF] Request finished in 10076.2886ms 503 application/json
2020-04-27 15:23:15.000 +08:00 [INF] Received HTTP response after 10103.697ms - "ServiceUnavailable"
2020-04-27 15:23:15.002 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:23:14 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:23:15.003 +08:00 [INF] End processing HTTP request after 10113.8006ms - "ServiceUnavailable"
2020-04-27 15:23:15.005 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:23:14 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:23:15.008 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:23:15.008 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:23:15.009 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:15.010 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:15.011 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:23:15.015 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:23:15.017 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:23:15.020 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:23:15.021 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:15.024 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:15.026 +08:00 [DBG] 'HealthChecksDb' generated a temporary value for the 'Id' property of new 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:23:15.027 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:23:15.028 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 15:23:15.028 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 15:23:15.031 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 15:23:15.032 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:15.034 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:15.035 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 15:23:15.038 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 15:23:15.039 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:23:15.040 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:23:15.043 +08:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 10), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Failures" ("HealthCheckName", "IsUpAndRunning", "LastNotified")
VALUES (@p0, @p1, @p2);
SELECT "Id"
FROM "Failures"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:23:15.045 +08:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 10), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Failures" ("HealthCheckName", "IsUpAndRunning", "LastNotified")
VALUES (@p0, @p1, @p2);
SELECT "Id"
FROM "Failures"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:23:15.048 +08:00 [DBG] Foreign key property 'HealthCheckFailureNotification.Id' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:23:15.050 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:23:15.050 +08:00 [DBG] Committing transaction.
2020-04-27 15:23:15.080 +08:00 [DBG] Committing transaction.
2020-04-27 15:23:15.080 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:15.092 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:15.092 +08:00 [DBG] Disposing transaction.
2020-04-27 15:23:15.092 +08:00 [DBG] An 'HealthCheckFailureNotification' entity tracked by 'HealthChecksDb' changed from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:23:15.092 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 1 entities written to the database.
2020-04-27 15:23:15.092 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 15:23:15.101 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:23:15.102 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2020-04-27 15:23:15.102 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:15.103 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:15.104 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:23:15.108 +08:00 [INF] Executed DbCommand (4ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:23:15.108 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:23:15.109 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:23:15.111 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:23:15.111 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:15.115 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:15.115 +08:00 [DBG] HealthReport history already exists and is in the same state, updating the values.
2020-04-27 15:23:15.116 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 15:23:15.116 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 15:23:15.117 +08:00 [DBG] Unchanged 'HealthCheckExecution.LastExecuted' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:23:15.118 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:23:15.120 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Description' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:23:15.121 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:23:15.121 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Duration' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:23:15.123 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 15:23:15.124 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:15.126 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:15.126 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 15:23:15.129 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 15:23:15.137 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:23:15.137 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:23:15.137 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:23:15.139 +08:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:23:15.140 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:23:15.141 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:23:15.142 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:23:15.143 +08:00 [DBG] Executing DbCommand [Parameters=[@p2='?', @p0='?' (Size = 343), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 15:23:15.145 +08:00 [INF] Executed DbCommand (1ms) [Parameters=[@p2='?', @p0='?' (Size = 343), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 15:23:15.146 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:23:15.146 +08:00 [DBG] Committing transaction.
2020-04-27 15:23:15.180 +08:00 [DBG] Committing transaction.
2020-04-27 15:23:15.180 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:15.193 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:15.193 +08:00 [DBG] Disposing transaction.
2020-04-27 15:23:15.193 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:23:15.193 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:23:15.193 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 15:23:15.193 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 15:23:15.193 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 15:23:15.194 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 15:23:25.206 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 15:23:25.208 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 15:23:25.210 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:23:25.211 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2020-04-27 15:23:25.211 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:25.212 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:25.212 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:23:25.215 +08:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:23:25.216 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:23:25.238 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:23:25.239 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:25.240 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:25.240 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 15:23:25.241 +08:00 [VRB] Request Headers:

2020-04-27 15:23:25.241 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 15:23:25.241 +08:00 [VRB] Request Headers:

2020-04-27 15:23:25.263 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 15:23:25.264 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:23:25.264 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 15:23:25.266 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 15:23:25.266 +08:00 [DBG] Running health checks
2020-04-27 15:23:25.266 +08:00 [DBG] Running health check redis
2020-04-27 15:23:40.387 +08:00 [ERR] Health check redis completed after 15120.999ms with status "Unhealthy" and 'null'
2020-04-27 15:23:40.388 +08:00 [DBG] Health check processing completed after 15121.4495ms with combined status "Unhealthy"
2020-04-27 15:23:40.390 +08:00 [DBG] Connection id "0HLVAFEITT3TE" completed keep alive response.
2020-04-27 15:23:40.390 +08:00 [INF] Request finished in 15127.8683ms 503 application/json
2020-04-27 15:23:40.401 +08:00 [INF] Received HTTP response after 15160.4384ms - "ServiceUnavailable"
2020-04-27 15:23:40.402 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:23:39 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:23:40.402 +08:00 [INF] End processing HTTP request after 15161.5531ms - "ServiceUnavailable"
2020-04-27 15:23:40.402 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:23:39 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:23:40.409 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:23:40.409 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:23:40.409 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:40.411 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:40.411 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:23:40.413 +08:00 [INF] Executed DbCommand (2ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:23:40.413 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:23:40.413 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:23:40.414 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:40.414 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:40.414 +08:00 [INF] Notification is sent on same window time.
2020-04-27 15:23:40.414 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 15:23:40.419 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:23:40.419 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:23:40.419 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:40.422 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:40.422 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:23:40.424 +08:00 [INF] Executed DbCommand (2ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:23:40.424 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:23:40.424 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:23:40.425 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:23:40.425 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:40.427 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:40.427 +08:00 [DBG] HealthReport history already exists and is in the same state, updating the values.
2020-04-27 15:23:40.427 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 15:23:40.427 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 15:23:40.427 +08:00 [DBG] Unchanged 'HealthCheckExecution.LastExecuted' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:23:40.429 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:23:40.429 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Description' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:23:40.430 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:23:40.430 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Duration' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:23:40.430 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 15:23:40.430 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:40.431 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:40.432 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 15:23:40.436 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 15:23:40.437 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:23:40.437 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:23:40.437 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:23:40.437 +08:00 [INF] Executed DbCommand (0ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:23:40.439 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:23:40.441 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:23:40.441 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:23:40.442 +08:00 [DBG] Executing DbCommand [Parameters=[@p2='?', @p0='?' (Size = 54), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 15:23:40.450 +08:00 [INF] Executed DbCommand (8ms) [Parameters=[@p2='?', @p0='?' (Size = 54), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 15:23:40.450 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:23:40.450 +08:00 [DBG] Committing transaction.
2020-04-27 15:23:40.485 +08:00 [DBG] Committing transaction.
2020-04-27 15:23:40.485 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:40.497 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:40.497 +08:00 [DBG] Disposing transaction.
2020-04-27 15:23:40.498 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:23:40.498 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:23:40.498 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 15:23:40.498 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 15:23:40.498 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 15:23:40.499 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 15:23:47.862 +08:00 [DBG] HttpMessageHandler expired after 120000ms for client 'health-checks-webhooks'
2020-04-27 15:23:47.862 +08:00 [DBG] HttpMessageHandler expired after 120000ms for client 'health-checks'
2020-04-27 15:23:50.500 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 15:23:50.502 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 15:23:50.503 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:23:50.503 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:23:50.503 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:50.504 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:50.504 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:23:50.508 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:23:50.509 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:23:50.509 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:23:50.510 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:50.513 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:23:50.514 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 15:23:50.514 +08:00 [VRB] Request Headers:

2020-04-27 15:23:50.514 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 15:23:50.514 +08:00 [VRB] Request Headers:

2020-04-27 15:23:50.555 +08:00 [DBG] Connection id "0HLVAFEITT3TH" accepted.
2020-04-27 15:23:50.555 +08:00 [DBG] Connection id "0HLVAFEITT3TH" started.
2020-04-27 15:23:50.557 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 15:23:50.557 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:23:50.558 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 15:23:50.559 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 15:23:50.560 +08:00 [DBG] Running health checks
2020-04-27 15:23:50.560 +08:00 [DBG] Running health check redis
2020-04-27 15:23:57.877 +08:00 [DBG] Starting HttpMessageHandler cleanup cycle with 2 items
2020-04-27 15:23:57.882 +08:00 [DBG] Ending HttpMessageHandler cleanup cycle after 0.0049ms - processed: 0 items - remaining: 2 items
2020-04-27 15:24:05.693 +08:00 [ERR] Health check redis completed after 15132.6214ms with status "Unhealthy" and 'null'
2020-04-27 15:24:05.693 +08:00 [DBG] Health check processing completed after 15132.9485ms with combined status "Unhealthy"
2020-04-27 15:24:05.694 +08:00 [DBG] Connection id "0HLVAFEITT3TH" completed keep alive response.
2020-04-27 15:24:05.694 +08:00 [INF] Request finished in 15137.1988ms 503 application/json
2020-04-27 15:24:05.709 +08:00 [INF] Received HTTP response after 15195.2909ms - "ServiceUnavailable"
2020-04-27 15:24:05.711 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:24:04 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:24:05.712 +08:00 [INF] End processing HTTP request after 15197.8472ms - "ServiceUnavailable"
2020-04-27 15:24:05.713 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:24:04 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:24:05.717 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:24:05.717 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:24:05.718 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:05.720 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:05.721 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:24:05.724 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:24:05.724 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:24:05.726 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:24:05.728 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:05.730 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:05.732 +08:00 [INF] Notification is sent on same window time.
2020-04-27 15:24:05.732 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 15:24:05.736 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:24:05.737 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:24:05.738 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:05.741 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:05.742 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:24:05.750 +08:00 [INF] Executed DbCommand (7ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:24:05.752 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:24:05.753 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:24:05.755 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:24:05.755 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:05.758 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:05.758 +08:00 [DBG] HealthReport history already exists and is in the same state, updating the values.
2020-04-27 15:24:05.758 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 15:24:05.759 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 15:24:05.763 +08:00 [DBG] Unchanged 'HealthCheckExecution.LastExecuted' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:24:05.764 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:24:05.767 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Description' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:24:05.767 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:24:05.768 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Duration' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:24:05.769 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 15:24:05.770 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:05.771 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:05.772 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 15:24:05.775 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 15:24:05.778 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:24:05.778 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:24:05.778 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:24:05.780 +08:00 [INF] Executed DbCommand (2ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:24:05.780 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:24:05.781 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:24:05.781 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:24:05.781 +08:00 [DBG] Executing DbCommand [Parameters=[@p2='?', @p0='?' (Size = 344), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 15:24:05.782 +08:00 [INF] Executed DbCommand (0ms) [Parameters=[@p2='?', @p0='?' (Size = 344), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 15:24:05.783 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:24:05.785 +08:00 [DBG] Committing transaction.
2020-04-27 15:24:05.820 +08:00 [DBG] Committing transaction.
2020-04-27 15:24:05.820 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:05.836 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:05.839 +08:00 [DBG] Disposing transaction.
2020-04-27 15:24:05.839 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:24:05.840 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:24:05.840 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 15:24:05.840 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 15:24:05.840 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 15:24:05.840 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 15:24:07.887 +08:00 [DBG] Starting HttpMessageHandler cleanup cycle with 2 items
2020-04-27 15:24:07.887 +08:00 [DBG] Ending HttpMessageHandler cleanup cycle after 0.0029ms - processed: 0 items - remaining: 2 items
2020-04-27 15:24:15.841 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 15:24:15.843 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 15:24:15.844 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:24:15.844 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:24:15.844 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:15.845 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:15.845 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:24:15.847 +08:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:24:15.849 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:24:15.849 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:24:15.849 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:15.851 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:15.851 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 15:24:15.851 +08:00 [VRB] Request Headers:

2020-04-27 15:24:15.851 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 15:24:15.851 +08:00 [VRB] Request Headers:

2020-04-27 15:24:15.863 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 15:24:15.864 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:24:15.865 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 15:24:15.865 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 15:24:15.865 +08:00 [DBG] Running health checks
2020-04-27 15:24:15.867 +08:00 [DBG] Running health check redis
2020-04-27 15:24:17.889 +08:00 [DBG] Starting HttpMessageHandler cleanup cycle with 2 items
2020-04-27 15:24:17.889 +08:00 [DBG] Ending HttpMessageHandler cleanup cycle after 0.0031ms - processed: 0 items - remaining: 2 items
2020-04-27 15:24:27.902 +08:00 [DBG] Starting HttpMessageHandler cleanup cycle with 2 items
2020-04-27 15:24:27.902 +08:00 [DBG] Ending HttpMessageHandler cleanup cycle after 0.005ms - processed: 0 items - remaining: 2 items
2020-04-27 15:24:30.975 +08:00 [ERR] Health check redis completed after 15107.8123ms with status "Unhealthy" and 'null'
2020-04-27 15:24:30.975 +08:00 [DBG] Health check processing completed after 15109.692ms with combined status "Unhealthy"
2020-04-27 15:24:30.977 +08:00 [DBG] Connection id "0HLVAFEITT3TH" completed keep alive response.
2020-04-27 15:24:30.978 +08:00 [INF] Request finished in 15115.1543ms 503 application/json
2020-04-27 15:24:30.989 +08:00 [INF] Received HTTP response after 15137.9187ms - "ServiceUnavailable"
2020-04-27 15:24:30.992 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:24:30 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:24:30.992 +08:00 [INF] End processing HTTP request after 15140.3136ms - "ServiceUnavailable"
2020-04-27 15:24:30.993 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:24:30 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:24:30.997 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:24:30.997 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:24:30.999 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:31.000 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:31.000 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:24:31.005 +08:00 [INF] Executed DbCommand (5ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:24:31.007 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:24:31.008 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:24:31.010 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:31.012 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:31.012 +08:00 [DBG] 'HealthChecksDb' generated a temporary value for the 'Id' property of new 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:24:31.012 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:24:31.012 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 15:24:31.012 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 15:24:31.012 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 15:24:31.013 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:31.015 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:31.015 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 15:24:31.019 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 15:24:31.025 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:24:31.025 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:24:31.025 +08:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 10), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Failures" ("HealthCheckName", "IsUpAndRunning", "LastNotified")
VALUES (@p0, @p1, @p2);
SELECT "Id"
FROM "Failures"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:24:31.029 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 10), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Failures" ("HealthCheckName", "IsUpAndRunning", "LastNotified")
VALUES (@p0, @p1, @p2);
SELECT "Id"
FROM "Failures"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:24:31.035 +08:00 [DBG] Foreign key property 'HealthCheckFailureNotification.Id' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:24:31.036 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:24:31.037 +08:00 [DBG] Committing transaction.
2020-04-27 15:24:31.068 +08:00 [DBG] Committing transaction.
2020-04-27 15:24:31.068 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:31.080 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:31.080 +08:00 [DBG] Disposing transaction.
2020-04-27 15:24:31.084 +08:00 [DBG] An 'HealthCheckFailureNotification' entity tracked by 'HealthChecksDb' changed from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:24:31.084 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 1 entities written to the database.
2020-04-27 15:24:31.085 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 15:24:31.088 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:24:31.088 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:24:31.088 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:31.090 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:31.091 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:24:31.096 +08:00 [INF] Executed DbCommand (6ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:24:31.097 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:24:31.099 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:24:31.101 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:24:31.101 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:31.103 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:31.103 +08:00 [DBG] HealthReport history already exists and is in the same state, updating the values.
2020-04-27 15:24:31.103 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 15:24:31.103 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 15:24:31.103 +08:00 [DBG] Unchanged 'HealthCheckExecution.LastExecuted' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:24:31.103 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:24:31.104 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Description' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:24:31.104 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:24:31.104 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Duration' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:24:31.104 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 15:24:31.104 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:31.106 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:31.109 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 15:24:31.110 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 15:24:31.119 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:24:31.119 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:24:31.120 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:24:31.123 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:24:31.123 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:24:31.125 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:24:31.125 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:24:31.127 +08:00 [DBG] Executing DbCommand [Parameters=[@p2='?', @p0='?' (Size = 344), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 15:24:31.134 +08:00 [INF] Executed DbCommand (7ms) [Parameters=[@p2='?', @p0='?' (Size = 344), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 15:24:31.136 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:24:31.146 +08:00 [DBG] Committing transaction.
2020-04-27 15:24:31.180 +08:00 [DBG] Committing transaction.
2020-04-27 15:24:31.180 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:31.193 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:24:31.193 +08:00 [DBG] Disposing transaction.
2020-04-27 15:24:31.193 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:24:31.193 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:24:31.193 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 15:24:31.193 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 15:24:31.193 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 15:24:31.194 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 15:29:43.810 +08:00 [DBG] Hosting starting
2020-04-27 15:29:44.036 +08:00 [DBG] Failed to locate the development https certificate at 'null'.
2020-04-27 15:29:44.046 +08:00 [INF] Now listening on: http://localhost:5001
2020-04-27 15:29:44.048 +08:00 [DBG] Loaded hosting startup assembly Leon.XXX.Api
2020-04-27 15:29:44.053 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 15:29:44.079 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 15:29:44.127 +08:00 [DBG] Connection id "0HLVAFJ0PL939" received FIN.
2020-04-27 15:29:44.127 +08:00 [DBG] Connection id "0HLVAFJ0PL938" received FIN.
2020-04-27 15:29:44.137 +08:00 [DBG] Connection id "0HLVAFJ0PL939" accepted.
2020-04-27 15:29:44.137 +08:00 [DBG] Connection id "0HLVAFJ0PL938" accepted.
2020-04-27 15:29:44.141 +08:00 [DBG] Connection id "0HLVAFJ0PL939" started.
2020-04-27 15:29:44.141 +08:00 [DBG] Connection id "0HLVAFJ0PL938" started.
2020-04-27 15:29:44.160 +08:00 [DBG] Connection id "0HLVAFJ0PL939" sending FIN because: "The client closed the connection."
2020-04-27 15:29:44.160 +08:00 [DBG] Connection id "0HLVAFJ0PL938" sending FIN because: "The client closed the connection."
2020-04-27 15:29:44.162 +08:00 [DBG] Connection id "0HLVAFJ0PL939" disconnecting.
2020-04-27 15:29:44.163 +08:00 [DBG] Connection id "0HLVAFJ0PL938" disconnecting.
2020-04-27 15:29:44.170 +08:00 [DBG] Connection id "0HLVAFJ0PL939" stopped.
2020-04-27 15:29:44.170 +08:00 [DBG] Connection id "0HLVAFJ0PL938" stopped.
2020-04-27 15:29:44.207 +08:00 [DBG] queryContext => new QueryingEnumerable<HealthCheckConfiguration>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache, 
    null, 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, int[], ResultCoordinator, HealthCheckConfiguration>, 
    HealthChecks.UI.Core.Data.HealthChecksDb, 
    DiagnosticsLogger<Query>
)
2020-04-27 15:29:44.224 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:29:44.230 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:29:44.231 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:29:44.233 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:29:44.239 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:29:44.253 +08:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:29:44.258 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:29:44.263 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:29:44.265 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:29:44.267 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:29:44.275 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 15:29:44.281 +08:00 [VRB] Request Headers:

2020-04-27 15:29:44.284 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 15:29:44.286 +08:00 [VRB] Request Headers:

2020-04-27 15:29:44.321 +08:00 [DBG] Connection id "0HLVAFJ0PL93A" accepted.
2020-04-27 15:29:44.322 +08:00 [DBG] Connection id "0HLVAFJ0PL93A" started.
2020-04-27 15:29:44.325 +08:00 [INF] Application started. Press Ctrl+C to shut down.
2020-04-27 15:29:44.325 +08:00 [INF] Hosting environment: Development
2020-04-27 15:29:44.325 +08:00 [INF] Content root path: F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api
2020-04-27 15:29:44.325 +08:00 [DBG] Hosting started
2020-04-27 15:29:44.353 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 15:29:44.357 +08:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2020-04-27 15:29:44.359 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:29:44.363 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 15:29:44.414 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 15:29:44.422 +08:00 [DBG] Running health checks
2020-04-27 15:29:44.427 +08:00 [DBG] Running health check redis
2020-04-27 15:29:47.557 +08:00 [DBG] Connection id "0HLVAFJ0PL93B" accepted.
2020-04-27 15:29:47.559 +08:00 [DBG] Connection id "0HLVAFJ0PL93B" started.
2020-04-27 15:29:47.560 +08:00 [DBG] Connection id "0HLVAFJ0PL93C" accepted.
2020-04-27 15:29:47.561 +08:00 [DBG] Connection id "0HLVAFJ0PL93C" started.
2020-04-27 15:29:47.571 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/swagger/index.html  
2020-04-27 15:29:47.572 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:29:47.585 +08:00 [DBG] The request path /swagger/index.html does not match an existing file
2020-04-27 15:29:47.612 +08:00 [DBG] Connection id "0HLVAFJ0PL93B" completed keep alive response.
2020-04-27 15:29:47.619 +08:00 [INF] Request finished in 46.9683ms 200 text/html;charset=utf-8
2020-04-27 15:29:47.853 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/docs/v1/docs.json  
2020-04-27 15:29:47.854 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:29:47.855 +08:00 [DBG] The request path /docs/v1/docs.json does not match an existing file
2020-04-27 15:29:47.964 +08:00 [DBG] Connection id "0HLVAFJ0PL93B" completed keep alive response.
2020-04-27 15:29:47.966 +08:00 [INF] Request finished in 112.4653ms 200 application/json;charset=utf-8
2020-04-27 15:29:59.721 +08:00 [ERR] Health check redis completed after 15291.0885ms with status "Unhealthy" and 'null'
2020-04-27 15:29:59.730 +08:00 [DBG] Health check processing completed after 15306.2957ms with combined status "Unhealthy"
2020-04-27 15:29:59.748 +08:00 [DBG] Connection id "0HLVAFJ0PL93A" completed keep alive response.
2020-04-27 15:29:59.750 +08:00 [INF] Request finished in 15397.5317ms 503 application/json
2020-04-27 15:29:59.774 +08:00 [INF] Received HTTP response after 15487.1393ms - "ServiceUnavailable"
2020-04-27 15:29:59.779 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:29:59 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:29:59.781 +08:00 [INF] End processing HTTP request after 15509.2805ms - "ServiceUnavailable"
2020-04-27 15:29:59.783 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:29:59 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:30:00.002 +08:00 [DBG] queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<HealthCheckFailureNotification>(
    asyncEnumerable: new QueryingEnumerable<HealthCheckFailureNotification>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache, 
        null, 
        null, 
        Func<QueryContext, DbDataReader, ResultContext, int[], ResultCoordinator, HealthCheckFailureNotification>, 
        HealthChecks.UI.Core.Data.HealthChecksDb, 
        DiagnosticsLogger<Query>
    ), 
    cancellationToken: queryContext.CancellationToken)
2020-04-27 15:30:00.010 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:30:00.010 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:30:00.012 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:00.015 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:00.022 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:30:00.026 +08:00 [INF] Executed DbCommand (11ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:30:00.029 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:30:00.029 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:00.033 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:00.041 +08:00 [DBG] 'HealthChecksDb' generated a temporary value for the 'Id' property of new 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:30:00.050 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:30:00.051 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 15:30:00.053 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 15:30:00.062 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 15:30:00.063 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:00.065 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:00.068 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 15:30:00.070 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 15:30:00.071 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:30:00.071 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:30:00.076 +08:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 10), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Failures" ("HealthCheckName", "IsUpAndRunning", "LastNotified")
VALUES (@p0, @p1, @p2);
SELECT "Id"
FROM "Failures"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:30:00.079 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 10), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Failures" ("HealthCheckName", "IsUpAndRunning", "LastNotified")
VALUES (@p0, @p1, @p2);
SELECT "Id"
FROM "Failures"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:30:00.082 +08:00 [DBG] Foreign key property 'HealthCheckFailureNotification.Id' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:30:00.083 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:30:00.084 +08:00 [DBG] Committing transaction.
2020-04-27 15:30:00.116 +08:00 [DBG] Committing transaction.
2020-04-27 15:30:00.116 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:00.128 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:00.128 +08:00 [DBG] Disposing transaction.
2020-04-27 15:30:00.136 +08:00 [DBG] An 'HealthCheckFailureNotification' entity tracked by 'HealthChecksDb' changed from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:30:00.136 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 1 entities written to the database.
2020-04-27 15:30:00.144 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 15:30:00.191 +08:00 [DBG] queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<HealthCheckExecution>(
    asyncEnumerable: new QueryingEnumerable<HealthCheckExecution>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache, 
        null, 
        null, 
        Func<QueryContext, DbDataReader, ResultContext, int[], ResultCoordinator, HealthCheckExecution>, 
        HealthChecks.UI.Core.Data.HealthChecksDb, 
        DiagnosticsLogger<Query>
    ), 
    cancellationToken: queryContext.CancellationToken)
2020-04-27 15:30:00.194 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:30:00.194 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:30:00.194 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:00.196 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:00.196 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:30:00.201 +08:00 [INF] Executed DbCommand (5ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:30:00.203 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:30:00.203 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:00.204 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:00.204 +08:00 [DBG] Creating a new HealthReport history.
2020-04-27 15:30:00.216 +08:00 [DBG] 'HealthChecksDb' generated a temporary value for the 'Id' property of new 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:30:00.234 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:30:00.241 +08:00 [DBG] 'HealthChecksDb' generated a temporary value for the 'Id' property of new 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:30:00.253 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:30:00.253 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 15:30:00.253 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 15:30:00.263 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 15:30:00.265 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:00.266 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:00.266 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 15:30:00.268 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 15:30:00.272 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:30:00.272 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:30:00.275 +08:00 [DBG] Executing DbCommand [Parameters=[@p0='?', @p1='?', @p2='?' (Size = 10), @p3='?', @p4='?', @p5='?' (Size = 7)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Executions" ("DiscoveryService", "LastExecuted", "Name", "OnStateFrom", "Status", "Uri")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
SELECT "Id"
FROM "Executions"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:30:00.277 +08:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?', @p1='?', @p2='?' (Size = 10), @p3='?', @p4='?', @p5='?' (Size = 7)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Executions" ("DiscoveryService", "LastExecuted", "Name", "OnStateFrom", "Status", "Uri")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
SELECT "Id"
FROM "Executions"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:30:00.279 +08:00 [DBG] Foreign key property 'HealthCheckExecution.Id' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:30:00.284 +08:00 [DBG] Foreign key property 'HealthCheckExecutionEntry.HealthCheckExecutionId' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:30:00.286 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:30:00.287 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:30:00.287 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:30:00.287 +08:00 [DBG] Executing DbCommand [Parameters=[@p6='?' (Size = 54), @p7='?', @p8='?', @p9='?' (Size = 5), @p10='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "HealthCheckExecutionEntries" ("Description", "Duration", "HealthCheckExecutionId", "Name", "Status")
VALUES (@p6, @p7, @p8, @p9, @p10);
SELECT "Id"
FROM "HealthCheckExecutionEntries"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:30:00.291 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@p6='?' (Size = 54), @p7='?', @p8='?', @p9='?' (Size = 5), @p10='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "HealthCheckExecutionEntries" ("Description", "Duration", "HealthCheckExecutionId", "Name", "Status")
VALUES (@p6, @p7, @p8, @p9, @p10);
SELECT "Id"
FROM "HealthCheckExecutionEntries"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:30:00.293 +08:00 [DBG] Foreign key property 'HealthCheckExecutionEntry.Id' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:30:00.294 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:30:00.295 +08:00 [DBG] Committing transaction.
2020-04-27 15:30:00.327 +08:00 [DBG] Committing transaction.
2020-04-27 15:30:00.328 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:00.340 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:00.340 +08:00 [DBG] Disposing transaction.
2020-04-27 15:30:00.344 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:30:00.346 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:30:00.346 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 15:30:00.346 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 15:30:00.350 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 15:30:00.351 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 15:30:10.355 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 15:30:10.381 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 15:30:10.383 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:30:10.383 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:30:10.384 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:10.386 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:10.386 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:30:10.389 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:30:10.389 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:30:10.392 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:30:10.392 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:10.393 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:10.393 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 15:30:10.393 +08:00 [VRB] Request Headers:

2020-04-27 15:30:10.393 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 15:30:10.393 +08:00 [VRB] Request Headers:

2020-04-27 15:30:10.420 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 15:30:10.420 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:30:10.420 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 15:30:10.424 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 15:30:10.424 +08:00 [DBG] Running health checks
2020-04-27 15:30:10.424 +08:00 [DBG] Running health check redis
2020-04-27 15:30:25.525 +08:00 [ERR] Health check redis completed after 15100.0303ms with status "Unhealthy" and 'null'
2020-04-27 15:30:25.525 +08:00 [DBG] Health check processing completed after 15100.7971ms with combined status "Unhealthy"
2020-04-27 15:30:25.529 +08:00 [DBG] Connection id "0HLVAFJ0PL93A" completed keep alive response.
2020-04-27 15:30:25.530 +08:00 [INF] Request finished in 15111.9949ms 503 application/json
2020-04-27 15:30:25.540 +08:00 [INF] Received HTTP response after 15147.3122ms - "ServiceUnavailable"
2020-04-27 15:30:25.543 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:30:25 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:30:25.544 +08:00 [INF] End processing HTTP request after 15149.9396ms - "ServiceUnavailable"
2020-04-27 15:30:25.545 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:30:25 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:30:25.551 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:30:25.551 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:30:25.553 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:25.555 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:25.556 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:30:25.559 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:30:25.562 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:30:25.564 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:30:25.565 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:25.567 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:25.569 +08:00 [INF] Notification is sent on same window time.
2020-04-27 15:30:25.569 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 15:30:25.572 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:30:25.572 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:30:25.572 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:25.574 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:25.574 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:30:25.580 +08:00 [INF] Executed DbCommand (6ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:30:25.582 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:30:25.590 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:30:25.593 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:30:25.594 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:25.597 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:25.597 +08:00 [DBG] HealthReport history already exists and is in the same state, updating the values.
2020-04-27 15:30:25.607 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 15:30:25.607 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 15:30:25.612 +08:00 [DBG] Unchanged 'HealthCheckExecution.LastExecuted' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:30:25.612 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:30:25.614 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Duration' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:30:25.617 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:30:25.618 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 15:30:25.620 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:25.621 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:25.621 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 15:30:25.625 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 15:30:25.631 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:30:25.631 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:30:25.633 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:30:25.635 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:30:25.639 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:30:25.642 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:30:25.642 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:30:25.642 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Duration" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:30:25.642 +08:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Duration" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:30:25.642 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:30:25.642 +08:00 [DBG] Committing transaction.
2020-04-27 15:30:25.688 +08:00 [DBG] Committing transaction.
2020-04-27 15:30:25.688 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:25.700 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:30:25.700 +08:00 [DBG] Disposing transaction.
2020-04-27 15:30:25.700 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:30:25.700 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:30:25.700 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 15:30:25.700 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 15:30:25.700 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 15:30:25.700 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 15:32:07.653 +08:00 [DBG] Hosting starting
2020-04-27 15:32:07.893 +08:00 [DBG] Failed to locate the development https certificate at 'null'.
2020-04-27 15:32:07.902 +08:00 [INF] Now listening on: http://localhost:5001
2020-04-27 15:32:07.904 +08:00 [DBG] Loaded hosting startup assembly Leon.XXX.Api
2020-04-27 15:32:07.908 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 15:32:07.941 +08:00 [DBG] Connection id "0HLVAFKBL5KUO" accepted.
2020-04-27 15:32:07.941 +08:00 [DBG] Connection id "0HLVAFKBL5KUN" accepted.
2020-04-27 15:32:07.941 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 15:32:07.944 +08:00 [DBG] Connection id "0HLVAFKBL5KUN" received FIN.
2020-04-27 15:32:07.944 +08:00 [DBG] Connection id "0HLVAFKBL5KUO" received FIN.
2020-04-27 15:32:07.945 +08:00 [DBG] Connection id "0HLVAFKBL5KUN" started.
2020-04-27 15:32:07.945 +08:00 [DBG] Connection id "0HLVAFKBL5KUO" started.
2020-04-27 15:32:07.988 +08:00 [DBG] Connection id "0HLVAFKBL5KUN" sending FIN because: "The client closed the connection."
2020-04-27 15:32:07.988 +08:00 [DBG] Connection id "0HLVAFKBL5KUO" sending FIN because: "The client closed the connection."
2020-04-27 15:32:07.989 +08:00 [DBG] Connection id "0HLVAFKBL5KUN" disconnecting.
2020-04-27 15:32:07.989 +08:00 [DBG] Connection id "0HLVAFKBL5KUO" disconnecting.
2020-04-27 15:32:07.998 +08:00 [DBG] Connection id "0HLVAFKBL5KUN" stopped.
2020-04-27 15:32:07.998 +08:00 [DBG] Connection id "0HLVAFKBL5KUO" stopped.
2020-04-27 15:32:08.080 +08:00 [DBG] queryContext => new QueryingEnumerable<HealthCheckConfiguration>(
    (RelationalQueryContext)queryContext, 
    RelationalCommandCache, 
    null, 
    null, 
    Func<QueryContext, DbDataReader, ResultContext, int[], ResultCoordinator, HealthCheckConfiguration>, 
    HealthChecks.UI.Core.Data.HealthChecksDb, 
    DiagnosticsLogger<Query>
)
2020-04-27 15:32:08.097 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:32:08.102 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2020-04-27 15:32:08.104 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:08.106 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:08.112 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:32:08.121 +08:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:32:08.126 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:32:08.131 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:32:08.133 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:08.135 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:08.143 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 15:32:08.150 +08:00 [VRB] Request Headers:

2020-04-27 15:32:08.153 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 15:32:08.155 +08:00 [VRB] Request Headers:

2020-04-27 15:32:08.193 +08:00 [DBG] Connection id "0HLVAFKBL5KUP" accepted.
2020-04-27 15:32:08.194 +08:00 [DBG] Connection id "0HLVAFKBL5KUP" started.
2020-04-27 15:32:08.196 +08:00 [INF] Application started. Press Ctrl+C to shut down.
2020-04-27 15:32:08.197 +08:00 [INF] Hosting environment: Development
2020-04-27 15:32:08.197 +08:00 [INF] Content root path: F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api
2020-04-27 15:32:08.197 +08:00 [DBG] Hosting started
2020-04-27 15:32:08.228 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 15:32:08.232 +08:00 [DBG] Wildcard detected, all requests with hosts will be allowed.
2020-04-27 15:32:08.232 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:32:08.236 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 15:32:08.282 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 15:32:08.288 +08:00 [DBG] Running health checks
2020-04-27 15:32:08.292 +08:00 [DBG] Running health check redis
2020-04-27 15:32:11.093 +08:00 [DBG] Connection id "0HLVAFKBL5KUQ" accepted.
2020-04-27 15:32:11.093 +08:00 [DBG] Connection id "0HLVAFKBL5KUQ" started.
2020-04-27 15:32:11.094 +08:00 [DBG] Connection id "0HLVAFKBL5KUR" accepted.
2020-04-27 15:32:11.095 +08:00 [DBG] Connection id "0HLVAFKBL5KUR" started.
2020-04-27 15:32:11.105 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/swagger/index.html  
2020-04-27 15:32:11.105 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:32:11.115 +08:00 [DBG] The request path /swagger/index.html does not match an existing file
2020-04-27 15:32:11.139 +08:00 [DBG] Connection id "0HLVAFKBL5KUQ" completed keep alive response.
2020-04-27 15:32:11.182 +08:00 [INF] Request finished in 57.785ms 200 text/html;charset=utf-8
2020-04-27 15:32:11.326 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/docs/v1/docs.json  
2020-04-27 15:32:11.326 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:32:11.327 +08:00 [DBG] The request path /docs/v1/docs.json does not match an existing file
2020-04-27 15:32:11.438 +08:00 [DBG] Connection id "0HLVAFKBL5KUQ" completed keep alive response.
2020-04-27 15:32:11.440 +08:00 [INF] Request finished in 114.0559ms 200 application/json;charset=utf-8
2020-04-27 15:32:23.564 +08:00 [ERR] Health check redis completed after 15269.2151ms with status "Unhealthy" and 'null'
2020-04-27 15:32:23.573 +08:00 [DBG] Health check processing completed after 15282.1187ms with combined status "Unhealthy"
2020-04-27 15:32:23.585 +08:00 [DBG] Connection id "0HLVAFKBL5KUP" completed keep alive response.
2020-04-27 15:32:23.586 +08:00 [INF] Request finished in 15358.4341ms 503 application/json
2020-04-27 15:32:23.613 +08:00 [INF] Received HTTP response after 15458.3002ms - "ServiceUnavailable"
2020-04-27 15:32:23.619 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:32:22 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:32:23.623 +08:00 [INF] End processing HTTP request after 15481.6674ms - "ServiceUnavailable"
2020-04-27 15:32:23.623 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:32:22 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:32:23.851 +08:00 [DBG] queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<HealthCheckFailureNotification>(
    asyncEnumerable: new QueryingEnumerable<HealthCheckFailureNotification>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache, 
        null, 
        null, 
        Func<QueryContext, DbDataReader, ResultContext, int[], ResultCoordinator, HealthCheckFailureNotification>, 
        HealthChecks.UI.Core.Data.HealthChecksDb, 
        DiagnosticsLogger<Query>
    ), 
    cancellationToken: queryContext.CancellationToken)
2020-04-27 15:32:23.858 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:32:23.858 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:32:23.858 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:23.860 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:23.865 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:32:23.868 +08:00 [INF] Executed DbCommand (8ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:32:23.870 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:32:23.870 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:23.874 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:23.882 +08:00 [DBG] 'HealthChecksDb' generated a temporary value for the 'Id' property of new 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:32:23.891 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:32:23.891 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 15:32:23.892 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 15:32:23.902 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 15:32:23.903 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:23.905 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:23.906 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 15:32:23.910 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 15:32:23.912 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:32:23.912 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:32:23.918 +08:00 [DBG] Executing DbCommand [Parameters=[@p0='?' (Size = 10), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Failures" ("HealthCheckName", "IsUpAndRunning", "LastNotified")
VALUES (@p0, @p1, @p2);
SELECT "Id"
FROM "Failures"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:32:23.921 +08:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 10), @p1='?', @p2='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Failures" ("HealthCheckName", "IsUpAndRunning", "LastNotified")
VALUES (@p0, @p1, @p2);
SELECT "Id"
FROM "Failures"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:32:23.924 +08:00 [DBG] Foreign key property 'HealthCheckFailureNotification.Id' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:32:23.925 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:32:23.925 +08:00 [DBG] Committing transaction.
2020-04-27 15:32:23.955 +08:00 [DBG] Committing transaction.
2020-04-27 15:32:23.955 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:23.967 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:23.967 +08:00 [DBG] Disposing transaction.
2020-04-27 15:32:23.975 +08:00 [DBG] An 'HealthCheckFailureNotification' entity tracked by 'HealthChecksDb' changed from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:32:23.975 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 1 entities written to the database.
2020-04-27 15:32:23.981 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 15:32:24.026 +08:00 [DBG] queryContext => ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync<HealthCheckExecution>(
    asyncEnumerable: new QueryingEnumerable<HealthCheckExecution>(
        (RelationalQueryContext)queryContext, 
        RelationalCommandCache, 
        null, 
        null, 
        Func<QueryContext, DbDataReader, ResultContext, int[], ResultCoordinator, HealthCheckExecution>, 
        HealthChecks.UI.Core.Data.HealthChecksDb, 
        DiagnosticsLogger<Query>
    ), 
    cancellationToken: queryContext.CancellationToken)
2020-04-27 15:32:24.029 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:32:24.029 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:32:24.029 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:24.030 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:24.031 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:32:24.036 +08:00 [INF] Executed DbCommand (4ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:32:24.036 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:32:24.037 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:24.040 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:24.040 +08:00 [DBG] Creating a new HealthReport history.
2020-04-27 15:32:24.049 +08:00 [DBG] 'HealthChecksDb' generated a temporary value for the 'Id' property of new 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:32:24.062 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:32:24.068 +08:00 [DBG] 'HealthChecksDb' generated a temporary value for the 'Id' property of new 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:32:24.080 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:32:24.080 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 15:32:24.080 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 15:32:24.090 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 15:32:24.091 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:24.092 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:24.092 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 15:32:24.096 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 15:32:24.099 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:32:24.099 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:32:24.102 +08:00 [DBG] Executing DbCommand [Parameters=[@p0='?', @p1='?', @p2='?' (Size = 10), @p3='?', @p4='?', @p5='?' (Size = 7)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Executions" ("DiscoveryService", "LastExecuted", "Name", "OnStateFrom", "Status", "Uri")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
SELECT "Id"
FROM "Executions"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:32:24.104 +08:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?', @p1='?', @p2='?' (Size = 10), @p3='?', @p4='?', @p5='?' (Size = 7)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Executions" ("DiscoveryService", "LastExecuted", "Name", "OnStateFrom", "Status", "Uri")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
SELECT "Id"
FROM "Executions"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:32:24.106 +08:00 [DBG] Foreign key property 'HealthCheckExecution.Id' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:32:24.111 +08:00 [DBG] Foreign key property 'HealthCheckExecutionEntry.HealthCheckExecutionId' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:32:24.113 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:32:24.114 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:32:24.114 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:32:24.115 +08:00 [DBG] Executing DbCommand [Parameters=[@p6='?' (Size = 54), @p7='?', @p8='?', @p9='?' (Size = 5), @p10='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "HealthCheckExecutionEntries" ("Description", "Duration", "HealthCheckExecutionId", "Name", "Status")
VALUES (@p6, @p7, @p8, @p9, @p10);
SELECT "Id"
FROM "HealthCheckExecutionEntries"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:32:24.118 +08:00 [INF] Executed DbCommand (2ms) [Parameters=[@p6='?' (Size = 54), @p7='?', @p8='?', @p9='?' (Size = 5), @p10='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "HealthCheckExecutionEntries" ("Description", "Duration", "HealthCheckExecutionId", "Name", "Status")
VALUES (@p6, @p7, @p8, @p9, @p10);
SELECT "Id"
FROM "HealthCheckExecutionEntries"
WHERE changes() = 1 AND "rowid" = last_insert_rowid();
2020-04-27 15:32:24.120 +08:00 [DBG] Foreign key property 'HealthCheckExecutionEntry.Id' detected as changed. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:32:24.121 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:32:24.121 +08:00 [DBG] Committing transaction.
2020-04-27 15:32:24.156 +08:00 [DBG] Committing transaction.
2020-04-27 15:32:24.156 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:24.168 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:24.168 +08:00 [DBG] Disposing transaction.
2020-04-27 15:32:24.173 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:32:24.176 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Added"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:32:24.176 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 15:32:24.176 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 15:32:24.179 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 15:32:24.180 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 15:32:34.189 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 15:32:34.215 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 15:32:34.218 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:32:34.219 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (1ms).
2020-04-27 15:32:34.219 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:34.221 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:34.223 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:32:34.227 +08:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:32:34.229 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:32:34.229 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:32:34.229 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:34.232 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:34.234 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 15:32:34.234 +08:00 [VRB] Request Headers:

2020-04-27 15:32:34.236 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 15:32:34.238 +08:00 [VRB] Request Headers:

2020-04-27 15:32:34.258 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 15:32:34.258 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:32:34.259 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 15:32:34.263 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 15:32:34.263 +08:00 [DBG] Running health checks
2020-04-27 15:32:34.265 +08:00 [DBG] Running health check redis
2020-04-27 15:32:49.382 +08:00 [ERR] Health check redis completed after 15117.4062ms with status "Unhealthy" and 'null'
2020-04-27 15:32:49.383 +08:00 [DBG] Health check processing completed after 15118.8197ms with combined status "Unhealthy"
2020-04-27 15:32:49.383 +08:00 [DBG] Connection id "0HLVAFKBL5KUP" completed keep alive response.
2020-04-27 15:32:49.383 +08:00 [INF] Request finished in 15125.783ms 503 application/json
2020-04-27 15:32:49.396 +08:00 [INF] Received HTTP response after 15159.552ms - "ServiceUnavailable"
2020-04-27 15:32:49.397 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:32:48 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:32:49.397 +08:00 [INF] End processing HTTP request after 15164.6087ms - "ServiceUnavailable"
2020-04-27 15:32:49.397 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:32:48 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:32:49.405 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:32:49.405 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:32:49.406 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:49.407 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:49.408 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:32:49.412 +08:00 [INF] Executed DbCommand (5ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:32:49.415 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:32:49.417 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:32:49.417 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:49.420 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:49.423 +08:00 [INF] Notification is sent on same window time.
2020-04-27 15:32:49.423 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 15:32:49.425 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:32:49.426 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:32:49.426 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:49.427 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:49.428 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:32:49.434 +08:00 [INF] Executed DbCommand (5ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:32:49.436 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:32:49.443 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:32:49.445 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:32:49.446 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:49.448 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:49.449 +08:00 [DBG] HealthReport history already exists and is in the same state, updating the values.
2020-04-27 15:32:49.453 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 15:32:49.453 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 15:32:49.457 +08:00 [DBG] Unchanged 'HealthCheckExecution.LastExecuted' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:32:49.458 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:32:49.460 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Duration' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:32:49.461 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:32:49.462 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 15:32:49.465 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:49.466 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:49.466 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 15:32:49.472 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 15:32:49.481 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:32:49.481 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:32:49.482 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:32:49.483 +08:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:32:49.489 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:32:49.490 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:32:49.490 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:32:49.490 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Duration" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:32:49.491 +08:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Duration" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:32:49.492 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:32:49.493 +08:00 [DBG] Committing transaction.
2020-04-27 15:32:49.527 +08:00 [DBG] Committing transaction.
2020-04-27 15:32:49.527 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:49.539 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:49.539 +08:00 [DBG] Disposing transaction.
2020-04-27 15:32:49.540 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:32:49.541 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:32:49.541 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 15:32:49.541 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 15:32:49.541 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 15:32:49.542 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 15:32:59.543 +08:00 [DBG] Executing HealthCheck collector HostedService.
2020-04-27 15:32:59.547 +08:00 [INF] Entity Framework Core 3.1.3 initialized 'HealthChecksDb' using provider 'Microsoft.EntityFrameworkCore.Sqlite' with options: None
2020-04-27 15:32:59.548 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:32:59.550 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:32:59.550 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:59.551 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:59.552 +08:00 [DBG] Executing DbCommand [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:32:59.557 +08:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "c"."Id", "c"."DiscoveryService", "c"."Name", "c"."Uri"
FROM "Configurations" AS "c"
2020-04-27 15:32:59.558 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckConfiguration' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:32:59.559 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:32:59.559 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:59.564 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:32:59.564 +08:00 [INF] Start processing HTTP request GET "http://localhost:5001/health"
2020-04-27 15:32:59.566 +08:00 [VRB] Request Headers:

2020-04-27 15:32:59.568 +08:00 [INF] Sending HTTP request GET "http://localhost:5001/health"
2020-04-27 15:32:59.569 +08:00 [VRB] Request Headers:

2020-04-27 15:32:59.584 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5001/health  
2020-04-27 15:32:59.585 +08:00 [VRB] All hosts are allowed.
2020-04-27 15:32:59.585 +08:00 [DBG] The request path /health does not match a supported file type
2020-04-27 15:32:59.589 +08:00 [DBG] The request path  does not match the path filter
2020-04-27 15:32:59.590 +08:00 [DBG] Running health checks
2020-04-27 15:32:59.590 +08:00 [DBG] Running health check redis
2020-04-27 15:33:09.518 +08:00 [DBG] Connection id "0HLVAFKBL5KUR" received FIN.
2020-04-27 15:33:09.519 +08:00 [DBG] Connection id "0HLVAFKBL5KUR" sending FIN because: "The client closed the connection."
2020-04-27 15:33:09.521 +08:00 [DBG] Connection id "0HLVAFKBL5KUR" disconnecting.
2020-04-27 15:33:09.524 +08:00 [DBG] Connection id "0HLVAFKBL5KUR" stopped.
2020-04-27 15:33:09.647 +08:00 [ERR] Health check redis completed after 10057.375ms with status "Unhealthy" and 'null'
2020-04-27 15:33:09.648 +08:00 [DBG] Health check processing completed after 10057.7718ms with combined status "Unhealthy"
2020-04-27 15:33:09.648 +08:00 [DBG] Connection id "0HLVAFKBL5KUP" completed keep alive response.
2020-04-27 15:33:09.648 +08:00 [INF] Request finished in 10064.3523ms 503 application/json
2020-04-27 15:33:09.665 +08:00 [INF] Received HTTP response after 10097.9289ms - "ServiceUnavailable"
2020-04-27 15:33:09.668 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:33:08 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:33:09.668 +08:00 [INF] End processing HTTP request after 10103.6961ms - "ServiceUnavailable"
2020-04-27 15:33:09.668 +08:00 [VRB] Response Headers:
Date: Mon, 27 Apr 2020 07:33:08 GMT
Server: Kestrel
Cache-Control: no-store, no-cache
Pragma: no-cache
Transfer-Encoding: chunked
Content-Type: application/json
Expires: Thu, 01 Jan 1970 00:00:00 GMT

2020-04-27 15:33:09.674 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:33:09.674 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:33:09.676 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:33:09.677 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:33:09.678 +08:00 [DBG] Executing DbCommand [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:33:09.682 +08:00 [INF] Executed DbCommand (5ms) [Parameters=[@__ToLower_0='?' (Size = 10), @__p_1='?'], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."HealthCheckName", "t"."IsUpAndRunning", "t"."LastNotified"
FROM (
    SELECT "f"."Id", "f"."HealthCheckName", "f"."IsUpAndRunning", "f"."LastNotified"
    FROM "Failures" AS "f"
    WHERE lower("f"."HealthCheckName") = @__ToLower_0
    ORDER BY "f"."LastNotified" DESC
    LIMIT @__p_1
) AS "t"
ORDER BY "t"."LastNotified" DESC
LIMIT 2
2020-04-27 15:33:09.684 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckFailureNotification' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:33:09.684 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:33:09.686 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:33:09.688 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:33:09.688 +08:00 [INF] Notification is sent on same window time.
2020-04-27 15:33:09.688 +08:00 [DBG] HealthReportCollector - health report execution history saved.
2020-04-27 15:33:09.693 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:33:09.694 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:33:09.694 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:33:09.695 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:33:09.695 +08:00 [DBG] Executing DbCommand [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:33:09.701 +08:00 [INF] Executed DbCommand (5ms) [Parameters=[@__configuration_Name_0='?' (Size = 10)], CommandType='"Text"', CommandTimeout='30']
SELECT "t"."Id", "t"."DiscoveryService", "t"."LastExecuted", "t"."Name", "t"."OnStateFrom", "t"."Status", "t"."Uri", "h"."Id", "h"."Description", "h"."HealthCheckExecutionId", "h"."Name", "h"."On", "h"."Status", "h0"."Id", "h0"."Description", "h0"."Duration", "h0"."HealthCheckExecutionId", "h0"."Name", "h0"."Status"
FROM (
    SELECT "e"."Id", "e"."DiscoveryService", "e"."LastExecuted", "e"."Name", "e"."OnStateFrom", "e"."Status", "e"."Uri"
    FROM "Executions" AS "e"
    WHERE "e"."Name" = @__configuration_Name_0
    LIMIT 2
) AS "t"
LEFT JOIN "HealthCheckExecutionHistories" AS "h" ON "t"."Id" = "h"."HealthCheckExecutionId"
LEFT JOIN "HealthCheckExecutionEntries" AS "h0" ON "t"."Id" = "h0"."HealthCheckExecutionId"
ORDER BY "t"."Id", "h"."Id", "h0"."Id"
2020-04-27 15:33:09.702 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecution' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:33:09.702 +08:00 [DBG] Context 'HealthChecksDb' started tracking 'HealthCheckExecutionEntry' entity. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:33:09.702 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:33:09.702 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:33:09.705 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:33:09.706 +08:00 [DBG] HealthReport history already exists and is in the same state, updating the values.
2020-04-27 15:33:09.706 +08:00 [DBG] SaveChanges starting for 'HealthChecksDb'.
2020-04-27 15:33:09.706 +08:00 [DBG] DetectChanges starting for 'HealthChecksDb'.
2020-04-27 15:33:09.708 +08:00 [DBG] Unchanged 'HealthCheckExecution.LastExecuted' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:33:09.708 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:33:09.708 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Description' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:33:09.708 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Unchanged"' to '"Modified"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:33:09.708 +08:00 [DBG] Unchanged 'HealthCheckExecutionEntry.Duration' detected as changed and will be marked as modified. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see property values.
2020-04-27 15:33:09.708 +08:00 [DBG] DetectChanges completed for 'HealthChecksDb'.
2020-04-27 15:33:09.708 +08:00 [DBG] Opening connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:33:09.709 +08:00 [DBG] Opened connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:33:09.709 +08:00 [DBG] Beginning transaction with isolation level 'Unspecified'.
2020-04-27 15:33:09.718 +08:00 [DBG] Began transaction with isolation level 'Serializable'.
2020-04-27 15:33:09.722 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:33:09.722 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:33:09.722 +08:00 [DBG] Executing DbCommand [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:33:09.723 +08:00 [INF] Executed DbCommand (1ms) [Parameters=[@p1='?', @p0='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "Executions" SET "LastExecuted" = @p0
WHERE "Id" = @p1;
SELECT changes();
2020-04-27 15:33:09.724 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:33:09.726 +08:00 [DBG] Creating DbCommand for 'ExecuteReader'.
2020-04-27 15:33:09.726 +08:00 [DBG] Created DbCommand for 'ExecuteReader' (0ms).
2020-04-27 15:33:09.727 +08:00 [DBG] Executing DbCommand [Parameters=[@p2='?', @p0='?' (Size = 343), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 15:33:09.729 +08:00 [INF] Executed DbCommand (1ms) [Parameters=[@p2='?', @p0='?' (Size = 343), @p1='?'], CommandType='"Text"', CommandTimeout='30']
UPDATE "HealthCheckExecutionEntries" SET "Description" = @p0, "Duration" = @p1
WHERE "Id" = @p2;
SELECT changes();
2020-04-27 15:33:09.729 +08:00 [DBG] A data reader was disposed.
2020-04-27 15:33:09.729 +08:00 [DBG] Committing transaction.
2020-04-27 15:33:09.763 +08:00 [DBG] Committing transaction.
2020-04-27 15:33:09.764 +08:00 [DBG] Closing connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:33:09.776 +08:00 [DBG] Closed connection to database 'main' on server 'F:\自己代码库\LeonMicroservice\src\Leon.XXX.Api\healthchecksdb'.
2020-04-27 15:33:09.777 +08:00 [DBG] Disposing transaction.
2020-04-27 15:33:09.779 +08:00 [DBG] An 'HealthCheckExecution' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:33:09.780 +08:00 [DBG] An 'HealthCheckExecutionEntry' entity tracked by 'HealthChecksDb' changed from '"Modified"' to '"Unchanged"'. Consider using 'DbContextOptionsBuilder.EnableSensitiveDataLogging' to see key values.
2020-04-27 15:33:09.780 +08:00 [DBG] SaveChanges completed for 'HealthChecksDb' with 2 entities written to the database.
2020-04-27 15:33:09.780 +08:00 [DBG] HealthReportCollector has completed.
2020-04-27 15:33:09.781 +08:00 [DBG] HealthCheck collector HostedService executed successfully.
2020-04-27 15:33:09.781 +08:00 [DBG] 'HealthChecksDb' disposed.
2020-04-27 15:33:13.807 +08:00 [INF] Application is shutting down...
2020-04-27 15:33:13.809 +08:00 [DBG] Hosting stopping
2020-04-27 15:33:13.814 +08:00 [DBG] Connection id "0HLVAFKBL5KUP" disconnecting.
2020-04-27 15:33:13.814 +08:00 [DBG] Connection id "0HLVAFKBL5KUQ" disconnecting.
2020-04-27 15:33:13.814 +08:00 [DBG] Connection id "0HLVAFKBL5KUP" stopped.
2020-04-27 15:33:13.814 +08:00 [DBG] Connection id "0HLVAFKBL5KUQ" stopped.
2020-04-27 15:33:13.814 +08:00 [DBG] Connection id "0HLVAFKBL5KUQ" sending FIN because: "The Socket transport's send loop completed gracefully."
2020-04-27 15:33:13.814 +08:00 [DBG] Connection id "0HLVAFKBL5KUP" sending FIN because: "The Socket transport's send loop completed gracefully."
2020-04-27 15:33:13.823 +08:00 [DBG] Hosting stopped
